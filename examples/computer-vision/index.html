<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta name="generator" content="Hugo 0.50" />
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Computer vision </title>

  
  <meta name="description" content="Triangulation of a dinosaur"> 
  
  
  
  
  

  

  <meta name="author" content="Paul Breiding, Christoph Schmidt">


  <meta property="og:title" content="Computer vision" />
<meta property="og:description" content="Triangulation of a dinosaur" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/examples/computer-vision/" /><meta property="article:published_time" content="2019-09-03T21:56:55&#43;01:00"/>
<meta property="article:modified_time" content="2019-09-03T21:56:55&#43;01:00"/>

  




  
  
  
  
  

  <link rel="canonical" href="/examples/computer-vision/">  

  

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">

  <link href="/css/font.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.min.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.legenda.css" rel="stylesheet" type="text/css">
  <link href="/css/highlight.css" rel="stylesheet" type="text/css">
  <link href="/css/master.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.demo.css" rel="stylesheet" type="text/css">


  <script src="/js/jquery-2.1.4.min.js" type="text/javascript"> </script>
  <script src="/js/bootstrap.min.js" type="text/javascript"> </script>

  <script type="text/javascript" src="/js/tocbot.min.js"></script>


    
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130815722-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-130815722-1');
  </script>

  

    
    
    <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/atom-one-light.min.css">
    <script src="/js/highlight.pack.js"></script>
    <script src="/js/init-highlight.js"></script>
 
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>

    
    <link href="/css/custom.css" rel="stylesheet" type="text/css">
    
</head>


<body class="page-kube">
  <header> <div class="show-sm">
    <div id="nav-toggle-box">
      <div id="nav-toggle-brand">
        <a href="/">HomotopyContinuation.jl</a>
      </div><a data-component="toggleme" data-target="#top" href="#" id="nav-toggle"><i class="kube-menu"></i></a>
    </div>
  </div>
  <div class="hide-sm" id="top">
    <div id="top-brand">
      <a href="/" title="home">HomotopyContinuation.jl</a>
    </div>
    <nav id="top-nav-main">
      <ul> 
       
       
    <li><a href="/guides/" >Guides</a></li>
    
    <li><a href="/examples/" >Examples</a></li>
    
    <li><a href="https://juliahomotopycontinuation.github.io/HomotopyContinuation.jl/stable/" >API Docs</a></li>
    
    <li><a href="/about/" >About</a></li>
    
    <li><a href="/faq/" >FAQ</a></li>
    
    <li><a href="/do-it-yourself" >Do It Yourself</a></li>
    
    <li><a href="https://www.github.com/JuliaHomotopyContinuation/HomotopyContinuation.jl" >Github</a></li>
    
      </ul>
    </nav>
    <nav id="top-nav-extra"> 
      <ul>
          
      </ul>
    </nav>
  </div>
 </header>
  <main>
<div class="push-center" itemscope itemtype="http://schema.org/API DocsPosting">
    
<meta itemprop="name" content="Computer vision">
<meta itemprop="description" content="Triangulation of a dinosaur">


<meta itemprop="datePublished" content="2019-09-03T21:56:55&#43;01:00" />
<meta itemprop="dateModified" content="2019-09-03T21:56:55&#43;01:00" />
<meta itemprop="wordCount" content="969">



<meta itemprop="keywords" content="example," />

<div id="hero">
    <h1 itemprop="headline">  Computer vision</h1>
    
<blockquote itemprop="description">Triangulation of a dinosaur</blockquote>

<time class="post-time"><span class="icon">
  <i class="fa fa-clock-o" aria-hidden="true"></i>
</span>
<span>5 minute read</span>
<span class="icon">
 <i class="fa fa-pencil" aria-hidden="true"></i>
</span>

  Published: <time datetime="2019-09-03T21:56:55&#43;01:00">3 Sep, 2019</time>

</time>
</div>
<div id="post-box">
<div id="post" itemprop="articleBody">
    
    

<p>(This post was worked out in a <a href="https://www.math.tu-berlin.de/fachgebiete_ag_diskalg/fachgebiet_algorithmische_algebra/v_menue/veranstaltungen/2019ss/software_seminar_numerical_nonlinear_algebra/">student seminar</a> that we held at TU Berlin in the summer 2019.)</p>

<p>We want to reconstruct a three-dimensional object from two-dimensional images. Think of an object, maybe a <a href="https://www.robots.ox.ac.uk/~vgg/data/data-mview.html&gt;">dinosaur</a>, that is captured by $n$ cameras from different angles. Suppose we have the following information available:</p>

<ul>
<li>the configuration of the cameras (in the form of <a href="https://en.wikipedia.org/wiki/Pinhole_camera_model&gt;">camera</a> <a href="https://en.wikipedia.org/wiki/Camera_matrix&gt;">matrices</a>);</li>
<li>sets of 2D points in the $n$ two-dimensional images, where each set corresponds to one 3D point.</li>
</ul>

<p>(Actually, the second bullet is the more challenging part in reconstructing three-dimensional objects. We assume that this task has already been done.)</p>

<p>The goal is to compute the following 3D picture</p>

<p style="text-align:center;"><img src="/images/dino.png" width="700px"/></p>

<p>In theory, it suffices to have two matching 2D points and the configuration of the cameras to <em>exactly</em> reconstruct the corresponding 3D point. In practice, there is lens distortion, pixelation, the algorithm matching the 2D points is not working fully precise and so on. This is why we are looking for 3D points that minimize the euclidean distance regarding their 2D image points. We want to solve an optimization problem.</p>

<p>This post is restricted to the case $n=2$, i.e. we want to reconstruct 3D points from images captured by two cameras at a time. We take the <a href="https://www.robots.ox.ac.uk/~vgg/data/data-mview.html&gt;">dinosaur</a> data set from the Visual Geometry Group
Department of Engineering Science at the University of Oxford. This contains a list of <a href="https://gist.github.com/PBrdng/46436855f3755c5a959a7c5d6ba7e32b#file-cameras-jl">36 cameras</a> as $3\times 4$ matrices and a corresponding list of <a href="https://gist.github.com/PBrdng/46436855f3755c5a959a7c5d6ba7e32b#file-pictures-jl">pictures taken from 4983 world points</a>. (For using the code below one must download the files from these links.)</p>

<p>Let $x\in\mathbb{R}^3$ be a 3D point. Then, taking a picture $u=(u_1,u_2)\in\mathbb{R}^2$ of $x$ is modeled as</p>

<p>$$ \begin{pmatrix} u_1 \\ u_2 \\ 1 \end{pmatrix} = t \, A \, \begin{pmatrix}x_1 \\ x_2 \\ x_3  \\ 1\end{pmatrix},$$</p>

<p>where $A\in \mathbb{R}^{3\times 4}$ is the camera matrix and $t \in \mathbb{R}, t \neq 0$, is a scalar. This is called the pinhole camera model. Let us write $y(x)$ for the first two entries of  $A \begin{pmatrix} x\\ 1\end{pmatrix}$, and $z(x)$ for the third entry. Then, $u=t y(x)$ and $1 = t z(x)$.</p>

<p>If $p = (p_1, p_2) \in\mathbb{R}^2\times \mathbb{R}^2$ are two input pictures from the data set, we want to solve the following minimization problem:</p>

<p>$$
\underset{(x,t) \in \mathbb{R}^3\times (\mathbb{R}\backslash \{0\})^2}{\operatorname{argmin}}\; \lVert t_1 \, y_1(x) - p_1 \rVert^2 + \lVert  t_2 \,  y_2(x) - p_2 \rVert^2
$$</p>

<p>$$
\text{s.t. }\; t_1 \, z_1(x) = 1 \;\text{ and } \;t_2 \, z_2(x)=1.\quad $$</p>

<h2 id="implementation-with-homotopy-continuation">Implementation with Homotopy Continuation</h2>

<p>Now let&rsquo;s solve this optimization problem using homotopy continuation by solving the critical equations. We use the cameras <code>n₁=1</code> and <code>n₂=2</code>. The camera data</p>

<pre><code class="language-julia">using DynamicPolynomials, LinearAlgebra, HomotopyContinuation

include(&quot;cameras.jl&quot;)
include(&quot;pictures.jl&quot;)
n₁, n₂ = 1, 2

@polyvar x[1:3]
@polyvar t[1:2]
@polyvar p[1:2,1:2]

y = [cams[i][1:2,:]*[x; 1] for i in camera_numbers]
z = [cams[i][3,:] ⋅ [x; 1] for i in camera_numbers] .* 648
</code></pre>

<p>The last multiplication by 648 is because the data is given in pixel units (between 0 and 648). For numerical stability it is better to work with coordinates between 0 and 1. Now, we define the target function.</p>

<pre><code class="language-julia">g = [t[i] .* y[i] - p[:,i] for i in 1:2]
G = sum(gᵢ ⋅ gᵢ for gᵢ in g)
# G is the function that we want to optimize
</code></pre>

<p>For <code>G</code> we generate the critical equations <code>F=0</code> using Lagrange multipliers.</p>

<pre><code class="language-julia">@polyvar λ[1:2] # the Lagrance multipliers
F = differentiate(G - sum(λ[i] * (t[i] * z[i] - 1) for i in 1:2), [x;t;λ])
</code></pre>

<p><code>F</code> is a system of polynomials in the variables <code>x</code>, <code>t</code> and <code>λ</code> and the parameters <code>p</code>. We want to solve this system many times for different parameters. For this, we use the guide on how to <a href="guides/many-systems">track many systems in a loop</a>.</p>

<p>First, we need an initial solution for a random set of parameters.</p>

<pre><code class="language-julia">p₀ = randn(ComplexF64, 4)
F₀ = [subs(Fᵢ, vec(p)=&gt;p₀) for Fᵢ in F]
start = solutions(solve(F₀))
</code></pre>

<p><code>start</code> contains 6 solutions. By the discussion at the end of this example, the number of critical points <code>F=0</code> is indeed 6. Now, we track these 6 solutions towards the photo parameters we are interested in.</p>

<pre><code class="language-julia">photos = ps[:, [1, 2, 3, 4]]
tracker = pathtracker(F; parameters=vec(p), generic_parameters=p₀)
reconstructed_points = Vector{Vector{Float64}}()

for pᵢ in photos
	# the data from the dataset is incomplete.
	# the cameras did not take pictures of all world points.
	# if a world point was not captured, the entry in the data set is -1.
	if all(pᵢ .&gt; 0)
		# we divide by 648 for working with coordinates between 0 and 1
		# (as explained above)
		set_parameters!(tracker; target_parameters=pᵢ./648)
		R = Vector{Vector{Float64}}() # array for the real solutions
		N = Vector{Float64}() # array for the values of the target function G
		for s in start
			result = track(tracker, s)
			if is_success(result) &amp;&amp; is_real(result)
				r = real.(solution(result))
				push!(R,r[1:3])
				push!(N, G([x;t]=&gt;r[1:5], vec(p) =&gt; pᵢ))
			end
			# add the real solution that minimizes the target function
			i = findmin(N)
			push!(reconstructed_points, R[i[2]])
		end
end

</code></pre>

<p>Doing this for several pairs of cameras we get the above picture.</p>

<h2 id="eddegree-of-the-multiview-variety">EDdegree of the Multiview variety</h2>

<p>The closure (under <a href="https://en.wikipedia.org/wiki/Zariski_topology&gt;">Zariski topology</a>) of</p>

<p>$$\{(t_1y_1(x), t_2y_2(x))\in \mathbb{R}^2\times \mathbb{R}^2  \, \mid \, t_1z_1(x) = t_2z_2(x) = 1,  (x,t)\in \mathbb{R}^3 \times (\mathbb{R}\backslash \{0\})^2\}$$</p>

<p>is called <em>(affine) multiview variety</em> for two cameras.</p>

<p>Regarding such an affine multiview variety, the number of (complex) critical points of the squared distance function <code>G</code> is an invariant, which is called the <em>euclidean distance degree</em> (ED degree). <a href="https://arxiv.org/abs/1812.05648&gt;">Maxim, Rodriguez and Wang proved</a> showed that the EDdegree of the Multiview variety for 2 cameras is 6. We used this information in the code above for verifying that the initial computation for <code>F₀</code> was correct.</p>

<strong>Cite this example:</strong>
<pre style="background: transparent;">
<code class="language-julia hljs">@Misc{ computer-vision2019 ,
    author =  { Paul Breiding, Christoph Schmidt },
    title = { Computer vision },
    howpublished = { \url{ https://www.JuliaHomotopyContinuation.org/examples/computer-vision/ } },
    note = { Accessed: October 23, 2019 }
}</code>
</pre>



</div>

<div class="">
    <p>
  Published
  
    
      by <span itemprop="author">Paul Breiding, Christoph Schmidt</span>
    
  
  <time datetime="2019-09-03T21:56:55&#43;01:00">
    3 Sep, 2019
  </time>
  
</p>

    
</div>


    
</div>
</div>
</main>
  <footer>   <footer id="footer">
    <nav>
      <ul>
        <li><span>HomotopyContinuation.jl</span></li>
        <li>
          <a href="/about/">About</a>
        </li>
        <li>
            <a href="/examples/">Examples</a>
          </li>
        <li>
          <a href="/guides/">Guides</a>
        </li>
      </ul>
    </nav>
    
  </footer> </footer>


  <script src="/js/kube.js" type="text/javascript">
  </script>
  <script src="/js/kube.legenda.js" type="text/javascript">
  </script>
  <script src="/js/master.js" type="text/javascript">
  </script>
  <script type="text/javascript">
     document.addEventListener("DOMContentLoaded", function() {
           renderMathInElement(document.body, {delimiters: [
          {left: "$$", right: "$$", display: true},
          {left: "$", right: "$", display: false},
          {left: "``", right: "``", display: false},
          
          
          
        ]});
      });</script>
</body>

</html>
