<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta name="generator" content="Hugo 0.60.0" />
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Energy minimization </title>

  
  <meta name="description" content="Computing a macroscopic configuration"> 
  
  
  
  
  

  

  <meta name="author" content="Paul Breiding">


  <meta property="og:title" content="Energy minimization" />
<meta property="og:description" content="Computing a macroscopic configuration" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/examples/energy-minimization/" />
<meta property="article:published_time" content="2020-01-17T21:56:55+01:00" />
<meta property="article:modified_time" content="2020-01-17T21:56:55+01:00" />

  




  
  
  
  
  

  <link rel="canonical" href="/examples/energy-minimization/">  

  

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">

  <link href="/css/font.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.min.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.legenda.css" rel="stylesheet" type="text/css">
  <link href="/css/highlight.css" rel="stylesheet" type="text/css">
  <link href="/css/master.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.demo.css" rel="stylesheet" type="text/css">


  <script src="/js/jquery-2.1.4.min.js" type="text/javascript"> </script>
  <script src="/js/bootstrap.min.js" type="text/javascript"> </script>

  <script type="text/javascript" src="/js/tocbot.min.js"></script>


    
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130815722-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    console.log(document.location.hostname.search("juliahomotopycontinuation.org") )
    
    if (document.location.hostname.search("juliahomotopycontinuation.org") == -1) {
      window['ga-disable-UA-130815722-1'] = true;
    }

    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-130815722-1');
  </script>


  

    
    
    <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/atom-one-light.min.css">
    <script src="/js/highlight.pack.js"></script>
    <script src="/js/init-highlight.js"></script>
 
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css" integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js" integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
    
    <link href="/css/custom.css" rel="stylesheet" type="text/css">
    
</head>


<body class="page-kube">
  <header> <div>
<div class="show-sm">
    <div id="nav-toggle-box">
      <div id="nav-toggle-brand">
        <a href="/">HomotopyContinuation.jl</a>
      </div><a data-component="toggleme" data-target="#top" href="#" id="nav-toggle"><i class="kube-menu"></i></a>
    </div>
  
  </div>
  <div class="hide-sm" id="top">
    <div id="top-brand">
      <a href="/" title="home">HomotopyContinuation.jl</a>
    </div>
    <nav id="top-nav-main">
      <ul> 
       
       
    <li><a href="/guides/" >Guides</a></li>
    
    <li><a href="/examples/" >Examples</a></li>
    
    <li><a href="https://juliahomotopycontinuation.github.io/HomotopyContinuation.jl/stable/" >Docs</a></li>
    
    <li><a href="/about/" >About</a></li>
    
    <li><a href="/faq/" >FAQ</a></li>
    
    <li><a href="/changelog/" >Changelog</a></li>
    
    <li><a href="https://www.github.com/JuliaHomotopyContinuation/HomotopyContinuation.jl" >Github</a></li>
    
      </ul>
    </nav>
    <nav id="top-nav-extra"> 
      <ul>
          
      </ul>
    </nav>
  </div>
  
</div> </header>
  <main>
<div class="push-center" itemscope itemtype="http://schema.org/API DocsPosting">
    <meta itemprop="name" content="Energy minimization">
<meta itemprop="description" content="Computing a macroscopic configuration">
<meta itemprop="datePublished" content="2020-01-17T21:56:55&#43;01:00" />
<meta itemprop="dateModified" content="2020-01-17T21:56:55&#43;01:00" />
<meta itemprop="wordCount" content="1347">



<meta itemprop="keywords" content="example," />
<div id="hero">
    <h1 itemprop="headline">  Energy minimization</h1>
    
<blockquote itemprop="description">Computing a macroscopic configuration</blockquote>

<time class="post-time"><span class="icon">
  <i class="fa fa-clock-o" aria-hidden="true"></i>
</span>
<span>7 minute read</span>
<span class="icon">
 <i class="fa fa-pencil" aria-hidden="true"></i>
</span>

  Published: <time datetime="2020-01-17T21:56:55&#43;01:00">17 Jan, 2020</time>

</time>
</div>
<div id="post-box">
<div id="post" itemprop="articleBody">
    
    <p>Consider a physical system of $N$ particles $q=(q_1,\ldots,q_N)\in M$. In our example we take $M$ to be the space of configurations of <a href="https://en.wikipedia.org/wiki/Cyclohexane">cyclohexane</a>. The $q_i$ are then the spacial positions of the six carbon atoms in a cyclohexane molecule. The constraints of this molecule are the following algebraic equations:</p>
<p>$$
M = \{(q_1,\ldots,q_6)\in (\mathbb{R}^3)^6 \mid
\Vert q_1-q_2\Vert^2 = \cdots= \Vert q_5-q_6\Vert^2 = \Vert q_6-q_1\Vert^2 = c^2\},
$$</p>
<p>where $c$ is the bond length between two neighboring atoms (the vectors $b_i = q_i - q_{i-1}$ are called bonds). In our example we take $c^2=1$ (unitless).</p>
<p>An example of such a configuration is shown in the next picture. It is called <a href="https://en.wikipedia.org/wiki/Cyclohexane_conformation#Chair_conformation">the chair</a>.</p>
<p style="text-align:center;"><img src="/images/chair.png" width="520px"/></p>
<p>In the framework of statistical physics, macroscopic quantities of interest are defined as averages over
probability measures on all configurations. As the probability measure we take the <a href="https://en.wikipedia.org/wiki/Canonical_ensemble">canonical ensemble</a>. If $E(q)$ denotes the total energy of a configuation $q$,  the density of a configuation $q$ in the canonical ensemble is proportional to</p>
<p>$$f(q) = e^{-E(q)}.$$</p>
<p>That is, a configuration is most likely to appear when its energy is minimal. In other words,</p>
<p style="margin-left: 40px;"><i> configurations that minimize the energy yield macroscopic quantities that we can observe </i>.</p>
<p>In this example we consider as quantitiy the average angle</p>
<p>$$\theta(q)=\frac{1}{6}(\angle(q_6 - q_1, q_2-q_1) + \cdots + \angle(q_5-q_6, q_1-q_6)).$$</p>
<p>between neighboring bonds $q_{i-1} - q_i$ and $q_{i+1} - q_i$, and we compute the macroscopic state of $\theta(q)$. To determine this state we approximate the distribution of $\theta(q)$:</p>
<p>$$\mathrm{Prob} \{\theta(q) = \theta_0\}  = \frac{\int_{\theta(q) = \theta_0} f(q) \mathrm{d} q}{K}, $$</p>
<p>where $K=\int_{V} f(q) \mathrm{d} q$ is the normalizing constant.</p>
<p>For comparing the probabilities of different values for $\theta$ it suffices to compute</p>
<p>$$\rho(\theta_0)=\int_{\theta(q) = \theta_0} f(q) \mathrm{d} q.$$</p>
<p>In the following we will approximate this integral using homotopy continuation. At the end of the computation stands the following result summarized in the next plot.</p>
<p style="text-align:center;"><img src="/images/cyclohexane_distribution.png" width="520px"/></p>
<p>The plot shows a peak at around $\theta =  114^{\circ}$. It is known that the total energy of the cyclohexane system is minimized when all angles between consecutive bonds achieve $110.9^{\circ}$. Our experiment gives a good approximation of the true molecular geometry of cyclohexane. An example where all the angles between consecutive bonds are $110.9^{\circ}$ is shown in the picture above.</p>
<h2 id="equations-for-the-cyclohexane-variety">Equations for the cyclohexane variety</h2>
<p>Due to rotational and translational invariance of the equations we define $q_1$ to be the origin, $q_6=(c,0,0)$ and $q_5$ to be rotated, such that its last entry is equal to zero (like in the <a href="cyclooctane.md">cyclooctane</a> example).</p>
<p>We thus have $11$ variables $x(q)=(x_1,\ldots,x_{11})$. Let us implement this in <code>Julia</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">using</span> HomotopyContinuation<span style="color:#f92672"></span>, DynamicPolynomials<span style="color:#f92672"></span>, LinearAlgebra<span style="color:#f92672"></span>
c²<span style="color:#f92672"></span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
N<span style="color:#f92672"></span>, n<span style="color:#f92672"></span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">6</span>

<span style="color:#a6e22e">@polyvar</span><span style="color:#f92672"></span> x<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>N<span style="color:#f92672"></span>]
q<span style="color:#f92672"></span>(x<span style="color:#f92672"></span>) <span style="color:#f92672">=</span> [
    zeros<span style="color:#f92672"></span>(<span style="color:#ae81ff">3</span>),
    x<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>],
    x<span style="color:#f92672"></span>[<span style="color:#ae81ff">4</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>],
    x<span style="color:#f92672"></span>[<span style="color:#ae81ff">7</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>],
    [x<span style="color:#f92672"></span>[<span style="color:#ae81ff">10</span>]; x<span style="color:#f92672"></span>[<span style="color:#ae81ff">11</span>]; <span style="color:#ae81ff">0.0</span>],
    [<span style="color:#f92672">√</span>c²<span style="color:#f92672"></span>; <span style="color:#ae81ff">0</span>; <span style="color:#ae81ff">0</span>]
    ]

F<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [(q<span style="color:#f92672"></span>(x<span style="color:#f92672"></span>)[i<span style="color:#f92672"></span>] <span style="color:#f92672">-</span> q<span style="color:#f92672"></span>(x<span style="color:#f92672"></span>)[i<span style="color:#f92672"></span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">⋅</span> (q<span style="color:#f92672"></span>(x<span style="color:#f92672"></span>)[i<span style="color:#f92672"></span>] <span style="color:#f92672">-</span> q<span style="color:#f92672"></span>(x<span style="color:#f92672"></span>)[i<span style="color:#f92672"></span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">-</span> c²<span style="color:#f92672"></span> <span style="color:#66d9ef">for</span> i<span style="color:#f92672"></span> <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>]
</code></pre></div><h2 id="total-energy-of-a-configuration">Total energy of a configuration</h2>
<p>We model the energy of a molecule using the <a href="https://en.wikipedia.org/wiki/Lennard-Jones_potential">Lennard Jones interaction potential</a></p>
<p>$$ V(x,y) =  \frac{1}{4}\left(\frac{c}{r}\right)^{12} -\frac{1}{2} \left(\frac{c}{r}\right)^{6}, \text{ where } r=\Vert x-y\Vert. $$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">c⁶<span style="color:#f92672"></span> <span style="color:#f92672">=</span> (c²<span style="color:#f92672"></span>)<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span>
<span style="color:#66d9ef">function</span> V<span style="color:#f92672"></span>(x<span style="color:#f92672"></span>,y<span style="color:#f92672"></span>)
    r⁶<span style="color:#f92672"></span> <span style="color:#f92672">=</span> ((x<span style="color:#f92672"></span><span style="color:#f92672">-</span>y<span style="color:#f92672"></span>)<span style="color:#f92672">⋅</span>(x<span style="color:#f92672"></span><span style="color:#f92672">-</span>y<span style="color:#f92672"></span>))<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span>
    a<span style="color:#f92672"></span> <span style="color:#f92672">=</span> c⁶<span style="color:#f92672"></span> <span style="color:#f92672">/</span> r⁶<span style="color:#f92672"></span>
    <span style="color:#66d9ef">return</span> a<span style="color:#f92672"></span><span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">-</span> a<span style="color:#f92672"></span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>The energy function of a configuration $q$ is then.</p>
<p>$$E(q) =  \sum_{1\leq i,j\leq N\atop i+2\leq j} V(q_i, q_j).$$</p>
<p>Here is the implementation of $E(q)$ and $f(q)=e^{-E(q)}$.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">E<span style="color:#f92672"></span>(q<span style="color:#f92672"></span>) <span style="color:#f92672">=</span> sum<span style="color:#f92672"></span>(V<span style="color:#f92672"></span>(q<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>], q<span style="color:#f92672"></span>[j<span style="color:#f92672"></span>]) <span style="color:#66d9ef">for</span> i<span style="color:#f92672"></span> <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span> <span style="color:#66d9ef">for</span> j<span style="color:#f92672"></span> <span style="color:#66d9ef">in</span> i<span style="color:#f92672"></span><span style="color:#f92672">+</span><span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>)
f<span style="color:#f92672"></span>(q<span style="color:#f92672"></span>) <span style="color:#f92672">=</span> exp<span style="color:#f92672"></span>(<span style="color:#f92672">-</span>E<span style="color:#f92672"></span>(q<span style="color:#f92672"></span>))
</code></pre></div><h2 id="integration-with-homotopy-continuation">Integration with homotopy continuation</h2>
<p>We approximate</p>
<p>$$\rho(\theta_0) \approx \frac{\mu_1(\theta_0)}{\mu_2(\theta_0)},$$</p>
<p>where</p>
<p>$$
\mu_1(\theta_0) = \int_{\theta(q)&gt;\theta_0 - \Delta\theta\atop \theta(q) &lt; \theta_0 + \Delta\theta} f(q) \mathrm{d} q \text{ and }
\mu_2(\theta_0) = \int_{\theta(q)&gt;\theta_0 - \Delta\theta\atop \theta(q) &lt; \theta_0 + \Delta\theta} 1 \mathrm{d} q
$$</p>
<p>for some $\Delta \theta &gt;0$. In our experiment we take $\Delta \theta = 3^\circ$ (degrees).</p>
<p>The two integrals are evaluated using the <a href="/examples/monte-carlo-integration">integration guide</a>. Recall from this guide that we have $\mu_1(\theta_0) = \mathbb{E}  \overline{f}(A,b),$ where</p>
<p>$$\overline{f}(A,b):= \sum_{q\in M: Ax(q)=b, \atop \theta- \Delta\theta &lt; \theta(q) &lt; \theta + \Delta\theta} \frac{f(q)}{\alpha(q)}\text{ and }\alpha(q) = \frac{\Gamma(\frac{n+1}{2})}{\sqrt{\pi}^{n+1}} \frac{\sqrt{1+\langle x(q), \pi_{x(q)} x(q)\rangle}}{(1+\Vert x(q)\Vert)^{\frac{n+1}{2}}},$$</p>
<p>and where $\pi_x$ is the orthogonal projection onto the normal space $\mathrm{N}_x M$ of $M$ at $x$.</p>
<p>Similarly, we define $\overline{1}(A,b)$ and get
$\mu_2(\theta_0)= \mathbb{E}  \overline{1}(A,b).$</p>
<p>Let us implement this in <code>Julia</code>. First, we define $\alpha(q)$.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">using</span> StaticPolynomials<span style="color:#f92672"></span> <span style="color:#75715e"># for fast evaluation of the Jacobian</span>
<span style="color:#66d9ef">const</span> SP<span style="color:#f92672"></span> <span style="color:#f92672">=</span> StaticPolynomials<span style="color:#f92672"></span>

F_SP<span style="color:#f92672"></span> <span style="color:#f92672">=</span> SP<span style="color:#f92672"></span><span style="color:#f92672">.</span>PolynomialSystem<span style="color:#f92672"></span>(F<span style="color:#f92672"></span>)
J<span style="color:#f92672"></span>(x<span style="color:#f92672"></span>) <span style="color:#f92672">=</span> transpose<span style="color:#f92672"></span>(SP<span style="color:#f92672"></span><span style="color:#f92672">.</span>jacobian<span style="color:#f92672"></span>(F_SP<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>))
<span style="color:#66d9ef">function</span> α<span style="color:#f92672"></span>(x₀<span style="color:#f92672"></span>)
    J₀<span style="color:#f92672"></span> <span style="color:#f92672">=</span> J<span style="color:#f92672"></span>(x₀<span style="color:#f92672"></span>)
    U<span style="color:#f92672"></span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">Matrix</span>(qr<span style="color:#f92672"></span>(J₀<span style="color:#f92672"></span>)<span style="color:#f92672">.</span>Q<span style="color:#f92672"></span>)
    π_x₀<span style="color:#f92672"></span> <span style="color:#f92672">=</span> U<span style="color:#f92672"></span> <span style="color:#f92672">*</span> (transpose<span style="color:#f92672"></span>(U<span style="color:#f92672"></span>) <span style="color:#f92672">*</span> x₀<span style="color:#f92672"></span>)
    <span style="color:#66d9ef">return</span> sqrt<span style="color:#f92672"></span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> (x₀<span style="color:#f92672"></span> <span style="color:#f92672">⋅</span> π_x₀<span style="color:#f92672"></span>)) <span style="color:#f92672">/</span>  sqrt<span style="color:#f92672"></span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> (x₀<span style="color:#f92672"></span> <span style="color:#f92672">⋅</span> x₀<span style="color:#f92672"></span>))<span style="color:#f92672">^</span>(n<span style="color:#f92672"></span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
<span style="color:#66d9ef">end</span>
</code></pre></div><p>We also need a function for the evaluation of $\theta(q)$.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">θ<span style="color:#f92672"></span>(q<span style="color:#f92672"></span>) <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">6</span>) <span style="color:#f92672">*</span> (
    ∠<span style="color:#f92672"></span>(q<span style="color:#f92672"></span>[<span style="color:#ae81ff">6</span>]<span style="color:#f92672">-</span>q<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span>], q<span style="color:#f92672"></span>[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>q<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span>]) <span style="color:#f92672">+</span>
    ∠<span style="color:#f92672"></span>(q<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">-</span>q<span style="color:#f92672"></span>[<span style="color:#ae81ff">2</span>], q<span style="color:#f92672"></span>[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">-</span>q<span style="color:#f92672"></span>[<span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span>
    ∠<span style="color:#f92672"></span>(q<span style="color:#f92672"></span>[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>q<span style="color:#f92672"></span>[<span style="color:#ae81ff">3</span>], q<span style="color:#f92672"></span>[<span style="color:#ae81ff">4</span>]<span style="color:#f92672">-</span>q<span style="color:#f92672"></span>[<span style="color:#ae81ff">3</span>]) <span style="color:#f92672">+</span>
    ∠<span style="color:#f92672"></span>(q<span style="color:#f92672"></span>[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">-</span>q<span style="color:#f92672"></span>[<span style="color:#ae81ff">4</span>], q<span style="color:#f92672"></span>[<span style="color:#ae81ff">5</span>]<span style="color:#f92672">-</span>q<span style="color:#f92672"></span>[<span style="color:#ae81ff">4</span>]) <span style="color:#f92672">+</span>
    ∠<span style="color:#f92672"></span>(q<span style="color:#f92672"></span>[<span style="color:#ae81ff">4</span>]<span style="color:#f92672">-</span>q<span style="color:#f92672"></span>[<span style="color:#ae81ff">5</span>], q<span style="color:#f92672"></span>[<span style="color:#ae81ff">6</span>]<span style="color:#f92672">-</span>q<span style="color:#f92672"></span>[<span style="color:#ae81ff">5</span>]) <span style="color:#f92672">+</span>
    ∠<span style="color:#f92672"></span>(q<span style="color:#f92672"></span>[<span style="color:#ae81ff">5</span>]<span style="color:#f92672">-</span>q<span style="color:#f92672"></span>[<span style="color:#ae81ff">6</span>], q<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">-</span>q<span style="color:#f92672"></span>[<span style="color:#ae81ff">6</span>])
    )

<span style="color:#66d9ef">function</span> ∠<span style="color:#f92672"></span>(b₁<span style="color:#f92672"></span>, b₂<span style="color:#f92672"></span>)
  γ <span style="color:#f92672">=</span> normalize<span style="color:#f92672"></span>(b₁<span style="color:#f92672"></span>) <span style="color:#f92672">⋅</span> normalize<span style="color:#f92672"></span>(b₂<span style="color:#f92672"></span>)
  <span style="color:#66d9ef">if</span> γ <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>
      <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0.0</span>
  <span style="color:#66d9ef">elseif</span> γ <span style="color:#f92672">&lt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
      <span style="color:#66d9ef">return</span> pi
  <span style="color:#66d9ef">else</span>
      <span style="color:#66d9ef">return</span> acos<span style="color:#f92672"></span>(γ)
  <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Now we implement $\overline{f}(A,b)$. We estimate the integrals $\mu_1$ and $\mu_2$ separately, and we have to define $\overline{f}(A,b)$ for both integrals separately. To take this into account, we implement the integrand $f$ as an input for <code>f̄</code>. The range of integration <code>θ₀ - Δθ ≦ θ ≦ θ₀ + Δθ</code> is also an input for to <code>f̄</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">using</span> SpecialFunctions<span style="color:#f92672"></span>
<span style="color:#66d9ef">const</span> SF<span style="color:#f92672"></span> <span style="color:#f92672">=</span> SpecialFunctions<span style="color:#f92672"></span>
Γ<span style="color:#f92672"></span> <span style="color:#f92672">=</span> pi<span style="color:#f92672">^</span>(n<span style="color:#f92672"></span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> SF<span style="color:#f92672"></span><span style="color:#f92672">.</span>gamma<span style="color:#f92672"></span>((n<span style="color:#f92672"></span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>)

<span style="color:#66d9ef">function</span> f̄<span style="color:#f92672"></span>(R<span style="color:#f92672"></span>, θ₀<span style="color:#f92672"></span>, Δθ<span style="color:#f92672"></span>, f<span style="color:#f92672"></span>)
    s<span style="color:#f92672"></span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
    θl<span style="color:#f92672"></span>, θu<span style="color:#f92672"></span> <span style="color:#f92672">=</span> θ₀<span style="color:#f92672"></span> <span style="color:#f92672">-</span> Δθ<span style="color:#f92672"></span>, θ₀<span style="color:#f92672"></span> <span style="color:#f92672">+</span> Δθ<span style="color:#f92672"></span>
    <span style="color:#66d9ef">if</span> nreal<span style="color:#f92672"></span>(R<span style="color:#f92672"></span>) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>
        <span style="color:#66d9ef">for</span> xᵢ<span style="color:#f92672"></span> <span style="color:#66d9ef">in</span> real_solutions<span style="color:#f92672"></span>(R<span style="color:#f92672"></span>)
            qᵢ<span style="color:#f92672"></span> <span style="color:#f92672">=</span> q<span style="color:#f92672"></span>(xᵢ<span style="color:#f92672"></span>)
            <span style="color:#66d9ef">if</span> θl<span style="color:#f92672"></span> <span style="color:#f92672">&lt;</span> θ<span style="color:#f92672"></span>(qᵢ<span style="color:#f92672"></span>) <span style="color:#f92672">&lt;</span> θu<span style="color:#f92672"></span>
                s<span style="color:#f92672"></span> <span style="color:#f92672">+=</span> f<span style="color:#f92672"></span>(qᵢ<span style="color:#f92672"></span>) <span style="color:#f92672">/</span> α<span style="color:#f92672"></span>(xᵢ<span style="color:#f92672"></span>)
            <span style="color:#66d9ef">end</span>
        <span style="color:#66d9ef">end</span>
    <span style="color:#66d9ef">end</span>
    Γ<span style="color:#f92672"></span> <span style="color:#f92672">.*</span> s<span style="color:#f92672"></span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Finally, to intersect the cyclohexane variety with linear spaces we create an artificial start system and compute its complex solutions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#a6e22e">@polyvar</span><span style="color:#f92672"></span> A<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>n<span style="color:#f92672"></span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>N<span style="color:#f92672"></span>] b<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>n<span style="color:#f92672"></span>]
G<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [F<span style="color:#f92672"></span>; A<span style="color:#f92672"></span> <span style="color:#f92672">*</span> x<span style="color:#f92672"></span> <span style="color:#f92672">-</span> b<span style="color:#f92672"></span>]

A₀<span style="color:#f92672"></span>, b₀<span style="color:#f92672"></span> <span style="color:#f92672">=</span> randn<span style="color:#f92672"></span>(ComplexF64<span style="color:#f92672"></span>, n<span style="color:#f92672"></span>, N<span style="color:#f92672"></span>), randn<span style="color:#f92672"></span>(ComplexF64<span style="color:#f92672"></span>, n<span style="color:#f92672"></span>)
G₀<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [subs<span style="color:#f92672"></span>(g<span style="color:#f92672"></span>, vec<span style="color:#f92672"></span>(A<span style="color:#f92672"></span>) <span style="color:#f92672">=</span><span style="color:#f92672">&gt;</span> vec<span style="color:#f92672"></span>(A₀<span style="color:#f92672"></span>), b<span style="color:#f92672"></span> <span style="color:#f92672">=</span><span style="color:#f92672">&gt;</span> b₀<span style="color:#f92672"></span>) <span style="color:#66d9ef">for</span> g<span style="color:#f92672"></span> <span style="color:#66d9ef">in</span> G<span style="color:#f92672"></span>]
start_sols<span style="color:#f92672"></span> <span style="color:#f92672">=</span> solutions<span style="color:#f92672"></span>(solve<span style="color:#f92672"></span>(G₀<span style="color:#f92672"></span>));
</code></pre></div><h2 id="computing-the-distribution-of-theta">Computing the distribution of $\theta$</h2>
<p>Now, we can compute the approximation of $\rho(\theta_0)$. We use $k=10^4$ linear sections and choose values $\frac{\pi}{4}\leq \theta_0\leq \frac{3\pi}{4}$.</p>
<p>First, we compute the empirical distributions for $f̄$ from which we infer $\mu_1$.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">k<span style="color:#f92672"></span>  <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span><span style="color:#f92672">^</span><span style="color:#ae81ff">4</span>,
Δθ<span style="color:#f92672"></span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> (<span style="color:#ae81ff">2</span>pi<span style="color:#f92672">/</span><span style="color:#ae81ff">360</span>)
θs<span style="color:#f92672"></span> <span style="color:#f92672">=</span> pi<span style="color:#f92672">/</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>Δθ<span style="color:#f92672"></span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>pi<span style="color:#f92672">/</span><span style="color:#ae81ff">4</span>
empirical_distributions_f̄<span style="color:#f92672"></span> <span style="color:#f92672">=</span> map<span style="color:#f92672"></span>(θs<span style="color:#f92672"></span>) <span style="color:#66d9ef">do</span> θ₀<span style="color:#f92672"></span>
    S<span style="color:#f92672"></span> <span style="color:#f92672">=</span> solve<span style="color:#f92672"></span>(
        G<span style="color:#f92672"></span>,
        start_sols<span style="color:#f92672"></span>;
        parameters<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [vec<span style="color:#f92672"></span>(A<span style="color:#f92672"></span>); b<span style="color:#f92672"></span>],
        start_parameters<span style="color:#f92672"></span> <span style="color:#f92672">=</span>  [vec<span style="color:#f92672"></span>(A₀<span style="color:#f92672"></span>); b₀<span style="color:#f92672"></span>],
        target_parameters<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [randn<span style="color:#f92672"></span>(n<span style="color:#f92672"></span><span style="color:#f92672">*</span>N<span style="color:#f92672"></span> <span style="color:#f92672">+</span> n<span style="color:#f92672"></span>) <span style="color:#66d9ef">for</span> _<span style="color:#f92672"></span> <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>k<span style="color:#f92672"></span>],
        transform_result<span style="color:#f92672"></span> <span style="color:#f92672">=</span> (R<span style="color:#f92672"></span>,p<span style="color:#f92672"></span>) <span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span> f̄<span style="color:#f92672"></span>(R<span style="color:#f92672"></span>, θ₀<span style="color:#f92672"></span>, Δθ<span style="color:#f92672"></span>)
    )
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Then, we compute the empirical distributions for $\overline{1}$ from which we infer $\mu_2$.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">empirical_distributions_const1̄<span style="color:#f92672"></span> <span style="color:#f92672">=</span> map<span style="color:#f92672"></span>(θs<span style="color:#f92672"></span>) <span style="color:#66d9ef">do</span> θ₀<span style="color:#f92672"></span>
    S<span style="color:#f92672"></span> <span style="color:#f92672">=</span> solve<span style="color:#f92672"></span>(
        G<span style="color:#f92672"></span>,
        start_sols<span style="color:#f92672"></span>;
        parameters<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [vec<span style="color:#f92672"></span>(A<span style="color:#f92672"></span>); b<span style="color:#f92672"></span>],
        start_parameters<span style="color:#f92672"></span> <span style="color:#f92672">=</span>  [vec<span style="color:#f92672"></span>(A₀<span style="color:#f92672"></span>); b₀<span style="color:#f92672"></span>],
        target_parameters<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [randn<span style="color:#f92672"></span>(n<span style="color:#f92672"></span><span style="color:#f92672">*</span>N<span style="color:#f92672"></span> <span style="color:#f92672">+</span> n<span style="color:#f92672"></span>) <span style="color:#66d9ef">for</span> _<span style="color:#f92672"></span> <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>k<span style="color:#f92672"></span>],
        transform_result<span style="color:#f92672"></span> <span style="color:#f92672">=</span> (R<span style="color:#f92672"></span>,p<span style="color:#f92672"></span>) <span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span> f̄<span style="color:#f92672"></span>(R<span style="color:#f92672"></span>, θ₀<span style="color:#f92672"></span>, Δθ<span style="color:#f92672"></span>, qᵢ<span style="color:#f92672"></span> <span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1.0</span>)
    )
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Here are the estimates for the distribution of $\theta$:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">using</span>  Statistics<span style="color:#f92672"></span>
μ₁<span style="color:#f92672"></span> <span style="color:#f92672">=</span> mean<span style="color:#f92672"></span><span style="color:#f92672">.</span>(empirical_distributions_f̄<span style="color:#f92672"></span>)
μ₂<span style="color:#f92672"></span> <span style="color:#f92672">=</span> mean<span style="color:#f92672"></span><span style="color:#f92672">.</span>(empirical_distributions_const1̄<span style="color:#f92672"></span>)
<span style="color:#75715e"># such that ρ = μ₁ ./ μ₂</span>
<span style="color:#75715e"># but  μ₁ ./ μ₂ has NaN entries, because μ₂ has zero entries</span>
<span style="color:#75715e"># we have to filter out the NaNs</span>
ρ<span style="color:#f92672"></span> <span style="color:#f92672">=</span> map<span style="color:#f92672"></span>(m<span style="color:#f92672"></span> <span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span> isnan<span style="color:#f92672"></span>(m<span style="color:#f92672"></span>) <span style="color:#f92672">?</span> <span style="color:#ae81ff">0.0</span> <span style="color:#f92672">:</span> m<span style="color:#f92672"></span>, μ1<span style="color:#f92672"></span> <span style="color:#f92672">./</span> μ2<span style="color:#f92672"></span>)
</code></pre></div><p>The next plot shows $\mu_1$ and $\mu_2$ in the logarithmic scale:</p>
<p style="text-align:center;"><img src="/images/mus.png" width="520px"/></p>
<h2 id="rate-of-convergence">Rate of convergence</h2>
<p>How good is the estimate? The analysis of variance from the <a href="/examples/monte-carlo-integration">the integration guide</a> yields for the empirical mean $\mathrm{E}(f,k) = \frac{1}{k}(\overline{f}(A_1,b_1) + \cdots \overline{f}(A_k,b_k))$:</p>
<p>$$\mathrm{Prob}\{\vert \mathrm{E}(f,k) -  \mu_1(\theta_0) \vert \geq \varepsilon \} \leq \frac{\sigma^2}{\varepsilon^2k},$$</p>
<p>where $\sigma^2$ is the variance of $\overline{f}(A,b)$ and similar for $E(1,k)$. From the plot above we can deduce that</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">ε<span style="color:#f92672"></span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e2</span>
</code></pre></div><p>is a good accuracy for both $\mu_1(\theta_0)$ and $\mu_2(\theta_0)$.</p>
<p>Using the empirical variances to approximate the true variance we get the following:</p>
<pre><code class="language-julia-repl" data-lang="julia-repl">julia&gt; s²(f̄) = std.(empirical_distributions_f̄)
julia&gt; maximum(s²(f̄) ./ (ε^2 * k))
0.0018945016028972723
</code></pre><p>and</p>
<pre><code class="language-julia-repl" data-lang="julia-repl">julia&gt; s²(const1̄) = std.(empirical_distributions_const1̄)
julia&gt; maximum(s²(const1̄) ./ (ε^2 * k))
0.0018301742629020274
</code></pre><p>That is, the maximum deviation probability is less than $1$% in both cases. We conclude that our approximation of $\rho(\theta) = K\mathrm{Prob}\{\theta(q) = \theta_0\}$ is a good approximation.</p>
<strong>Cite this example:</strong>
<pre style="background: transparent;">
<code class="language-julia hljs">@Misc{ energy-minimization2025 ,
    author =  { Paul Breiding },
    title = { Energy minimization },
    howpublished = { \url{ https://www.JuliaHomotopyContinuation.org/examples/energy-minimization/ } },
    note = { Accessed: January 31, 2025 }
}</code>
</pre>



</div>

<div class="">
    <p>
  Published
  
    
      by <span itemprop="author">Paul Breiding</span>
    
  
  <time datetime="2020-01-17T21:56:55&#43;01:00">
    17 Jan, 2020
  </time>
  
</p>

    
</div>


    
</div>
</div>
</main>
  <footer>   <footer id="footer">
    <nav>
      <ul>
        <li><span>HomotopyContinuation.jl</span></li>
        <li>
          <a href="/about/">About</a>
        </li>
        <li>
            <a href="/examples/">Examples</a>
          </li>
        <li>
          <a href="/guides/">Guides</a>
        </li>
      </ul>
    </nav>
    
  </footer> </footer>


  <script src="/js/kube.js" type="text/javascript">
  </script>
  <script src="/js/kube.legenda.js" type="text/javascript">
  </script>
  <script src="/js/master.js" type="text/javascript">
  </script>
  <script type="text/javascript">
     document.addEventListener("DOMContentLoaded", function() {
           renderMathInElement(document.body, {delimiters: [
          {left: "$$", right: "$$", display: true},
          {left: "$", right: "$", display: false},
          {left: "``", right: "``", display: false},
          
          
          
        ]});
      });</script>
</body>

</html>
