<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta name="generator" content="Hugo 0.60.0" />
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Rolling shutter cameras </title>

  
  <meta name="description" content="Absolute pose estimation for a rolling shutter camera"> 
  
  
  
  
  

  

  <meta name="author" content="Rami Abuzerr, Paul Breiding">


  <meta property="og:title" content="Rolling shutter cameras" />
<meta property="og:description" content="Absolute pose estimation for a rolling shutter camera" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/examples/rolling-shutter/" />
<meta property="article:published_time" content="2019-03-26T21:56:55+01:00" />
<meta property="article:modified_time" content="2019-03-26T21:56:55+01:00" />

  




  
  
  
  
  

  <link rel="canonical" href="/examples/rolling-shutter/">  

  

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">

  <link href="/css/font.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.min.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.legenda.css" rel="stylesheet" type="text/css">
  <link href="/css/highlight.css" rel="stylesheet" type="text/css">
  <link href="/css/master.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.demo.css" rel="stylesheet" type="text/css">


  <script src="/js/jquery-2.1.4.min.js" type="text/javascript"> </script>
  <script src="/js/bootstrap.min.js" type="text/javascript"> </script>

  <script type="text/javascript" src="/js/tocbot.min.js"></script>


    
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130815722-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    console.log(document.location.hostname.search("juliahomotopycontinuation.org") )
    
    if (document.location.hostname.search("juliahomotopycontinuation.org") == -1) {
      window['ga-disable-UA-130815722-1'] = true;
    }

    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-130815722-1');
  </script>


  

    
    
    <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/atom-one-light.min.css">
    <script src="/js/highlight.pack.js"></script>
    <script src="/js/init-highlight.js"></script>
 
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css" integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js" integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
    
    <link href="/css/custom.css" rel="stylesheet" type="text/css">
    
</head>


<body class="page-kube">
  <header> <div>
<div class="show-sm">
    <div id="nav-toggle-box">
      <div id="nav-toggle-brand">
        <a href="/">HomotopyContinuation.jl</a>
      </div><a data-component="toggleme" data-target="#top" href="#" id="nav-toggle"><i class="kube-menu"></i></a>
    </div>
  
  </div>
  <div class="hide-sm" id="top">
    <div id="top-brand">
      <a href="/" title="home">HomotopyContinuation.jl</a>
    </div>
    <nav id="top-nav-main">
      <ul> 
       
       
    <li><a href="/guides/" >Guides</a></li>
    
    <li><a href="/examples/" >Examples</a></li>
    
    <li><a href="https://juliahomotopycontinuation.github.io/HomotopyContinuation.jl/stable/" >Docs</a></li>
    
    <li><a href="/about/" >About</a></li>
    
    <li><a href="/faq/" >FAQ</a></li>
    
    <li><a href="/do-it-yourself" >Do It Yourself</a></li>
    
    <li><a href="/changelog/" >Changelog</a></li>
    
    <li><a href="https://www.github.com/JuliaHomotopyContinuation/HomotopyContinuation.jl" >Github</a></li>
    
      </ul>
    </nav>
    <nav id="top-nav-extra"> 
      <ul>
          
      </ul>
    </nav>
  </div>
  
</div> </header>
  <main>
<div class="push-center" itemscope itemtype="http://schema.org/API DocsPosting">
    <meta itemprop="name" content="Rolling shutter cameras">
<meta itemprop="description" content="Absolute pose estimation for a rolling shutter camera">
<meta itemprop="datePublished" content="2019-03-26T21:56:55&#43;01:00" />
<meta itemprop="dateModified" content="2019-03-26T21:56:55&#43;01:00" />
<meta itemprop="wordCount" content="948">



<meta itemprop="keywords" content="example," />
<div id="hero">
    <h1 itemprop="headline">  Rolling shutter cameras</h1>
    
<blockquote itemprop="description">Absolute pose estimation for a rolling shutter camera</blockquote>

<time class="post-time"><span class="icon">
  <i class="fa fa-clock-o" aria-hidden="true"></i>
</span>
<span>5 minute read</span>
<span class="icon">
 <i class="fa fa-pencil" aria-hidden="true"></i>
</span>

  Published: <time datetime="2019-03-26T21:56:55&#43;01:00">26 Mar, 2019</time>

</time>
</div>
<div id="post-box">
<div id="post" itemprop="articleBody">
    
    <p>We want to find the absolute pose for a calibrated rolling shutter camera. Suppose we have the following information available:</p>
<ul>
<li>A set of 3D scene points expressed in the world coordinate frame.</li>
<li>Sets of 2D points in the two-dimensional images, where each set corresponds to one 3D point.</li>
</ul>
<p>Let us load the data:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">using</span> DelimitedFiles<span style="color:#f92672"></span>
link1<span style="color:#f92672"></span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">h</span><span style="color:#e6db74">t</span><span style="color:#e6db74">t</span><span style="color:#e6db74">p</span><span style="color:#e6db74">s</span><span style="color:#e6db74">:</span><span style="color:#e6db74">/</span><span style="color:#e6db74">/</span><span style="color:#e6db74">g</span><span style="color:#e6db74">i</span><span style="color:#e6db74">s</span><span style="color:#e6db74">t</span><span style="color:#e6db74">.</span><span style="color:#e6db74">g</span><span style="color:#e6db74">i</span><span style="color:#e6db74">t</span><span style="color:#e6db74">h</span><span style="color:#e6db74">u</span><span style="color:#e6db74">b</span><span style="color:#e6db74">u</span><span style="color:#e6db74">s</span><span style="color:#e6db74">e</span><span style="color:#e6db74">r</span><span style="color:#e6db74">c</span><span style="color:#e6db74">o</span><span style="color:#e6db74">n</span><span style="color:#e6db74">t</span><span style="color:#e6db74">e</span><span style="color:#e6db74">n</span><span style="color:#e6db74">t</span><span style="color:#e6db74">.</span><span style="color:#e6db74">c</span><span style="color:#e6db74">o</span><span style="color:#e6db74">m</span><span style="color:#e6db74">/</span><span style="color:#e6db74">P</span><span style="color:#e6db74">B</span><span style="color:#e6db74">r</span><span style="color:#e6db74">d</span><span style="color:#e6db74">n</span><span style="color:#e6db74">g</span><span style="color:#e6db74">/</span><span style="color:#e6db74">e</span><span style="color:#e6db74">1</span><span style="color:#e6db74">7</span><span style="color:#e6db74">d</span><span style="color:#e6db74">0</span><span style="color:#e6db74">e</span><span style="color:#e6db74">3</span><span style="color:#e6db74">b</span><span style="color:#e6db74">c</span><span style="color:#e6db74">4</span><span style="color:#e6db74">d</span><span style="color:#e6db74">9</span><span style="color:#e6db74">8</span><span style="color:#e6db74">3</span><span style="color:#e6db74">7</span><span style="color:#e6db74">3</span><span style="color:#e6db74">4</span><span style="color:#e6db74">2</span><span style="color:#e6db74">3</span><span style="color:#e6db74">8</span><span style="color:#e6db74">b</span><span style="color:#e6db74">9</span><span style="color:#e6db74">c</span><span style="color:#e6db74">b</span><span style="color:#e6db74">8</span><span style="color:#e6db74">3</span><span style="color:#e6db74">8</span><span style="color:#e6db74">6</span><span style="color:#e6db74">d</span><span style="color:#e6db74">5</span><span style="color:#e6db74">6</span><span style="color:#e6db74">0</span><span style="color:#e6db74">/</span><span style="color:#e6db74">r</span><span style="color:#e6db74">a</span><span style="color:#e6db74">w</span><span style="color:#e6db74">/</span><span style="color:#e6db74">0</span><span style="color:#e6db74">7</span><span style="color:#e6db74">2</span><span style="color:#e6db74">7</span><span style="color:#e6db74">2</span><span style="color:#e6db74">b</span><span style="color:#e6db74">1</span><span style="color:#e6db74">2</span><span style="color:#e6db74">5</span><span style="color:#e6db74">a</span><span style="color:#e6db74">6</span><span style="color:#e6db74">a</span><span style="color:#e6db74">d</span><span style="color:#e6db74">0</span><span style="color:#e6db74">3</span><span style="color:#e6db74">c</span><span style="color:#e6db74">7</span><span style="color:#e6db74">9</span><span style="color:#e6db74">1</span><span style="color:#e6db74">f</span><span style="color:#e6db74">d</span><span style="color:#e6db74">f</span><span style="color:#e6db74">9</span><span style="color:#e6db74">9</span><span style="color:#e6db74">e</span><span style="color:#e6db74">7</span><span style="color:#e6db74">4</span><span style="color:#e6db74">1</span><span style="color:#e6db74">3</span><span style="color:#e6db74">1</span><span style="color:#e6db74">8</span><span style="color:#e6db74">f</span><span style="color:#e6db74">1</span><span style="color:#e6db74">d</span><span style="color:#e6db74">8</span><span style="color:#e6db74">5</span><span style="color:#e6db74">1</span><span style="color:#e6db74">4</span><span style="color:#e6db74">9</span><span style="color:#e6db74">b</span><span style="color:#e6db74">/</span><span style="color:#e6db74">3</span><span style="color:#e6db74">D</span><span style="color:#e6db74">p</span><span style="color:#e6db74">o</span><span style="color:#e6db74">i</span><span style="color:#e6db74">n</span><span style="color:#e6db74">t</span><span style="color:#e6db74">s</span><span style="color:#e6db74">&#34;</span>
link2<span style="color:#f92672"></span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">h</span><span style="color:#e6db74">t</span><span style="color:#e6db74">t</span><span style="color:#e6db74">p</span><span style="color:#e6db74">s</span><span style="color:#e6db74">:</span><span style="color:#e6db74">/</span><span style="color:#e6db74">/</span><span style="color:#e6db74">g</span><span style="color:#e6db74">i</span><span style="color:#e6db74">s</span><span style="color:#e6db74">t</span><span style="color:#e6db74">.</span><span style="color:#e6db74">g</span><span style="color:#e6db74">i</span><span style="color:#e6db74">t</span><span style="color:#e6db74">h</span><span style="color:#e6db74">u</span><span style="color:#e6db74">b</span><span style="color:#e6db74">u</span><span style="color:#e6db74">s</span><span style="color:#e6db74">e</span><span style="color:#e6db74">r</span><span style="color:#e6db74">c</span><span style="color:#e6db74">o</span><span style="color:#e6db74">n</span><span style="color:#e6db74">t</span><span style="color:#e6db74">e</span><span style="color:#e6db74">n</span><span style="color:#e6db74">t</span><span style="color:#e6db74">.</span><span style="color:#e6db74">c</span><span style="color:#e6db74">o</span><span style="color:#e6db74">m</span><span style="color:#e6db74">/</span><span style="color:#e6db74">P</span><span style="color:#e6db74">B</span><span style="color:#e6db74">r</span><span style="color:#e6db74">d</span><span style="color:#e6db74">n</span><span style="color:#e6db74">g</span><span style="color:#e6db74">/</span><span style="color:#e6db74">e</span><span style="color:#e6db74">1</span><span style="color:#e6db74">7</span><span style="color:#e6db74">d</span><span style="color:#e6db74">0</span><span style="color:#e6db74">e</span><span style="color:#e6db74">3</span><span style="color:#e6db74">b</span><span style="color:#e6db74">c</span><span style="color:#e6db74">4</span><span style="color:#e6db74">d</span><span style="color:#e6db74">9</span><span style="color:#e6db74">8</span><span style="color:#e6db74">3</span><span style="color:#e6db74">7</span><span style="color:#e6db74">3</span><span style="color:#e6db74">4</span><span style="color:#e6db74">2</span><span style="color:#e6db74">3</span><span style="color:#e6db74">8</span><span style="color:#e6db74">b</span><span style="color:#e6db74">9</span><span style="color:#e6db74">c</span><span style="color:#e6db74">b</span><span style="color:#e6db74">8</span><span style="color:#e6db74">3</span><span style="color:#e6db74">8</span><span style="color:#e6db74">6</span><span style="color:#e6db74">d</span><span style="color:#e6db74">5</span><span style="color:#e6db74">6</span><span style="color:#e6db74">0</span><span style="color:#e6db74">/</span><span style="color:#e6db74">r</span><span style="color:#e6db74">a</span><span style="color:#e6db74">w</span><span style="color:#e6db74">/</span><span style="color:#e6db74">0</span><span style="color:#e6db74">7</span><span style="color:#e6db74">2</span><span style="color:#e6db74">7</span><span style="color:#e6db74">2</span><span style="color:#e6db74">b</span><span style="color:#e6db74">1</span><span style="color:#e6db74">2</span><span style="color:#e6db74">5</span><span style="color:#e6db74">a</span><span style="color:#e6db74">6</span><span style="color:#e6db74">a</span><span style="color:#e6db74">d</span><span style="color:#e6db74">0</span><span style="color:#e6db74">3</span><span style="color:#e6db74">c</span><span style="color:#e6db74">7</span><span style="color:#e6db74">9</span><span style="color:#e6db74">1</span><span style="color:#e6db74">f</span><span style="color:#e6db74">d</span><span style="color:#e6db74">f</span><span style="color:#e6db74">9</span><span style="color:#e6db74">9</span><span style="color:#e6db74">e</span><span style="color:#e6db74">7</span><span style="color:#e6db74">4</span><span style="color:#e6db74">1</span><span style="color:#e6db74">3</span><span style="color:#e6db74">1</span><span style="color:#e6db74">8</span><span style="color:#e6db74">f</span><span style="color:#e6db74">1</span><span style="color:#e6db74">d</span><span style="color:#e6db74">8</span><span style="color:#e6db74">5</span><span style="color:#e6db74">1</span><span style="color:#e6db74">4</span><span style="color:#e6db74">9</span><span style="color:#e6db74">b</span><span style="color:#e6db74">/</span><span style="color:#e6db74">2</span><span style="color:#e6db74">D</span><span style="color:#e6db74">p</span><span style="color:#e6db74">o</span><span style="color:#e6db74">i</span><span style="color:#e6db74">n</span><span style="color:#e6db74">t</span><span style="color:#e6db74">s</span><span style="color:#e6db74">&#34;</span>
points3D<span style="color:#f92672"></span> <span style="color:#f92672">=</span> readdlm<span style="color:#f92672"></span>(download<span style="color:#f92672"></span>(link1<span style="color:#f92672"></span>)) <span style="color:#f92672">|&gt;</span> transpose<span style="color:#f92672"></span>
points2D<span style="color:#f92672"></span> <span style="color:#f92672">=</span> readdlm<span style="color:#f92672"></span>(download<span style="color:#f92672"></span>(link2<span style="color:#f92672"></span>)) <span style="color:#f92672">|&gt;</span> transpose<span style="color:#f92672"></span>
</code></pre></div><p>Now <code>points2D</code> is a $3\times N$ matrix, where $N$ is the number of images. The first two rows of <code>points2D</code> are the coordinates of the respective images, and the third row gives the <em>scanlines</em>. 
A rolling shutter camera captures images line by line over time. These lines are called scanlines.</p>
<figure>
<p style="text-align:center;"><img src="/images/rollingshutter1.png" width="600px"/></p>
<figcaption style="text-align:center;">
The 2D image taken with our rolling shutter camera. The color encodes the scanline that takes a picture of that point.
</figcaption>
</figure>
<p>Similarly <code>points3D</code> is a $4\times N$ matrix, where $N$ is the number of images. The columns of <code>points2D</code> and <code>points3D</code> are synchronized in the sense that the $i$-th column of <code>points2D</code> is the image of the $i$-th column of <code>points3D</code>.</p>
<figure>
<p style="text-align:center;"><img src="/images/rollingshutter2.png" width="600px"/></p>
<figcaption style="text-align:center;">
The 3D points that we take an image from. The color encodes the scanline that takes a picture of that point.
</figcaption>
</figure>
<p>We want to reconstruct the camera from this data. For this, we use a model introduced by Saurer et al.<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>. Their morel introduces a linear velocity in the camera projection matrix to approximate the motion of the rolling shutter camera. Furthermore, the model assumes that each scanline takes exactly the same time, and the relative camera translation  $t_n$ at the $n$-th scanline is</p>
<p>$$
t_n = \mathbf{v}n \tau \quad 
$$</p>
<p>where $\mathbf{v}\in\mathbb R^3$ denotes the constant linear camera velocity, and $\tau$ is the time taken to complete each scanline, and $n$ ist the number of scanline.
Making the assumption of a constant linear velocity, we can express a pixel on the $n$th scanline as:</p>
<p>$$x_n = \begin{bmatrix} R &amp; t - t_n \end{bmatrix} X,$$</p>
<p>where $R$ is an orthogonal matrix (we assume calibrated cameras).</p>
<p>The variables $R$ and $t$ describe the camera’s position and orientation in the world frame, which is also its position for the first captured scanline. The variable $t_n$ represents the camera’s position for the $n$-th scanline. The correspondence between $x_n$ and $X$ signifies a relationship between a 2D point in the image and its corresponding 3D point. The given data in this equation consist of a set of 2D image points denoted by $x_n$ and their corresponding 3D points represented by $X$. The unknowns in this equation are $R$, $t$, and the linear velocity $v$ in $t_n$, amounting to a total of 9 degrees of freedom (3 each for $R$, $t$, and $v$). Consequently, we need at least</p>
<p>$$ m = 5$$</p>
<p>images for reconstruction.</p>
<p>By taking the cross product of $x_n$ , we obtain $x_n \times (\begin{bmatrix} R &amp; t - t_n \end{bmatrix} X) = 0$
Assuming noisy data, we attempt to reconstruct $R,t$ and $v$ by solving the optimization problem</p>
<p>$$\min\quad  \left\Vert x_n \times (\begin{bmatrix} R &amp; t - t_n \end{bmatrix} X)\right\Vert. $$</p>
<h3 id="implementation-with-homotopy-continuation">Implementation with Homotopy Continuation</h3>
<p>Now let's solve this optimization problem using homotopy continuation by solving the critical equations. In our case we have</p>
<p>$$\tau = 0.01.$$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">using</span> HomotopyContinuation<span style="color:#f92672"></span>, LinearAlgebra<span style="color:#f92672"></span>, StatsBase<span style="color:#f92672"></span>

τ<span style="color:#f92672"></span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.01</span>
m<span style="color:#f92672"></span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
<span style="color:#a6e22e">@var</span><span style="color:#f92672"></span> x<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>m<span style="color:#f92672"></span>], u<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>m<span style="color:#f92672"></span>]
<span style="color:#a6e22e">@var</span><span style="color:#f92672"></span> R<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], t<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], v<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], n<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>m<span style="color:#f92672"></span>]

cams<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [[R<span style="color:#f92672"></span> t<span style="color:#f92672"></span><span style="color:#f92672">-</span>(n<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>]<span style="color:#f92672">*</span>τ<span style="color:#f92672"></span>)<span style="color:#f92672">.*</span>v<span style="color:#f92672"></span>] <span style="color:#66d9ef">for</span> i<span style="color:#f92672"></span> <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>m<span style="color:#f92672"></span>] <span style="color:#75715e"># m = 5 cameras</span>
y<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [cams<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>] <span style="color:#f92672">*</span> [x<span style="color:#f92672"></span>[<span style="color:#f92672">:</span>,i<span style="color:#f92672"></span>]; <span style="color:#ae81ff">1</span>] <span style="color:#66d9ef">for</span> i<span style="color:#f92672"></span> <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>m<span style="color:#f92672"></span>] <span style="color:#75715e"># m = 5 images</span>
</code></pre></div><p>Now we define the function that we want to minimize.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">g<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [cross<span style="color:#f92672"></span>(y<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>],  [u<span style="color:#f92672"></span>[<span style="color:#f92672">:</span>,i<span style="color:#f92672"></span>]; <span style="color:#ae81ff">1</span>]) <span style="color:#66d9ef">for</span> i<span style="color:#f92672"></span> <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>m<span style="color:#f92672"></span>]
</code></pre></div><p>Since $R$ is constrained to be an orthogonal matrix and $v$ is constrained to have norm $1$, we use Lagrange multipliers for optimization.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">k<span style="color:#f92672"></span> <span style="color:#f92672">=</span> R<span style="color:#f92672"></span> <span style="color:#f92672">*</span> R<span style="color:#f92672">&#39;</span> <span style="color:#f92672">-</span> diagm<span style="color:#f92672"></span>(ones<span style="color:#f92672"></span>(<span style="color:#ae81ff">3</span>))
Rconstraints<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [k<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>,j<span style="color:#f92672"></span>] <span style="color:#66d9ef">for</span> i<span style="color:#f92672"></span> <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>, j<span style="color:#f92672"></span> <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span> <span style="color:#66d9ef">if</span> i<span style="color:#f92672"></span><span style="color:#f92672">&lt;</span><span style="color:#f92672">=</span>j<span style="color:#f92672"></span>]
vconstraints<span style="color:#f92672"></span> <span style="color:#f92672">=</span> transpose<span style="color:#f92672"></span>(v<span style="color:#f92672"></span>) <span style="color:#f92672">*</span> v<span style="color:#f92672"></span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>

<span style="color:#a6e22e">@var</span><span style="color:#f92672"></span> l1<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>], l2<span style="color:#f92672"></span>       <span style="color:#75715e"># Lagrange multipliers </span>
L<span style="color:#f92672"></span> <span style="color:#f92672">=</span> transpose<span style="color:#f92672"></span>(g<span style="color:#f92672"></span>) <span style="color:#f92672">*</span> g<span style="color:#f92672"></span> <span style="color:#f92672">-</span> transpose<span style="color:#f92672"></span>(l1<span style="color:#f92672"></span>) <span style="color:#f92672">*</span> Rconstraints<span style="color:#f92672"></span> <span style="color:#f92672">-</span> l2<span style="color:#f92672"></span> <span style="color:#f92672">*</span> vconstraints<span style="color:#f92672"></span>
Lag<span style="color:#f92672"></span> <span style="color:#f92672">=</span> differentiate<span style="color:#f92672"></span>(L<span style="color:#f92672"></span>, [vec<span style="color:#f92672"></span>(R<span style="color:#f92672"></span>); t<span style="color:#f92672"></span>; v<span style="color:#f92672"></span>; l1<span style="color:#f92672"></span>; l2<span style="color:#f92672"></span>]);

F<span style="color:#f92672"></span> <span style="color:#f92672">=</span> System<span style="color:#f92672"></span>(Lag<span style="color:#f92672"></span>, variables<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [vec<span style="color:#f92672"></span>(R<span style="color:#f92672"></span>); t<span style="color:#f92672"></span>; v<span style="color:#f92672"></span>; l1<span style="color:#f92672"></span>; l2<span style="color:#f92672"></span>], parameters<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [vec<span style="color:#f92672"></span>(x<span style="color:#f92672"></span>); vec<span style="color:#f92672"></span>([u<span style="color:#f92672"></span>; n<span style="color:#f92672">&#39;</span>])]);
</code></pre></div><p>Solving <code>F</code> then gives all critical points. We want to solve this system many times for different parameters.<br>
First, we need an initial solution for a random set of parameters.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">p0<span style="color:#f92672"></span> <span style="color:#f92672">=</span> randn<span style="color:#f92672"></span>(ComplexF64<span style="color:#f92672"></span>, <span style="color:#ae81ff">30</span>) 
S0<span style="color:#f92672"></span> <span style="color:#f92672">=</span> solve<span style="color:#f92672"></span>(F<span style="color:#f92672"></span>, target_parameters<span style="color:#f92672"></span> <span style="color:#f92672">=</span> p0<span style="color:#f92672"></span>)
start<span style="color:#f92672"></span> <span style="color:#f92672">=</span> solutions<span style="color:#f92672"></span>(S0<span style="color:#f92672"></span>);
</code></pre></div><p>The array <code>start</code> contains 480 solutions. Now, we track these 80 solutions towards the photo parameters we are interested in</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">N<span style="color:#f92672"></span> <span style="color:#f92672">=</span> size<span style="color:#f92672"></span>(points2D<span style="color:#f92672"></span>, <span style="color:#ae81ff">2</span>)
s<span style="color:#f92672"></span> <span style="color:#f92672">=</span> StatsBase<span style="color:#f92672"></span><span style="color:#f92672">.</span>sample<span style="color:#f92672"></span>(collect<span style="color:#f92672"></span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>N<span style="color:#f92672"></span>), m<span style="color:#f92672"></span>; replace<span style="color:#f92672"></span><span style="color:#f92672">=</span><span style="color:#66d9ef">false</span>)

X<span style="color:#f92672"></span> <span style="color:#f92672">=</span> points2D<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>, s<span style="color:#f92672"></span>] 
Y<span style="color:#f92672"></span> <span style="color:#f92672">=</span> points2D<span style="color:#f92672"></span>[<span style="color:#f92672">:</span>, s<span style="color:#f92672"></span>]

p1<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [vec<span style="color:#f92672"></span>(X<span style="color:#f92672"></span>); vec<span style="color:#f92672"></span>(Y<span style="color:#f92672"></span>)]
S1<span style="color:#f92672"></span> <span style="color:#f92672">=</span> solve<span style="color:#f92672"></span>(F<span style="color:#f92672"></span>, start<span style="color:#f92672"></span>, start_parameters<span style="color:#f92672"></span> <span style="color:#f92672">=</span> p0<span style="color:#f92672"></span>, target_parameters<span style="color:#f92672"></span> <span style="color:#f92672">=</span> p1<span style="color:#f92672"></span>) 
</code></pre></div><p>We solved the system <code>F</code> using parameter homotopies, with the start parameter <code>p0</code> and the target parameter <code>p1</code>.<br>
Then we evaluate each solution <code>r</code> with the parameter <code>r</code> computing the norm of <code>g(r,p)</code> and return the solution that has the smallest norm.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">G<span style="color:#f92672"></span> <span style="color:#f92672">=</span> System<span style="color:#f92672"></span>(vcat<span style="color:#f92672"></span>(g<span style="color:#f92672"></span><span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>), variables<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [vec<span style="color:#f92672"></span>(R<span style="color:#f92672"></span>); t<span style="color:#f92672"></span>; v<span style="color:#f92672"></span>], parameters<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [vec<span style="color:#f92672"></span>(x<span style="color:#f92672"></span>); vec<span style="color:#f92672"></span>([u<span style="color:#f92672"></span>; n<span style="color:#f92672">&#39;</span>])]);
<span style="color:#66d9ef">function</span> find_min<span style="color:#f92672"></span>(sols<span style="color:#f92672"></span>, p<span style="color:#f92672"></span>)
    sols<span style="color:#f92672"></span> <span style="color:#f92672">=</span> [r<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">15</span>] <span style="color:#66d9ef">for</span> r<span style="color:#f92672"></span> <span style="color:#66d9ef">in</span> sols<span style="color:#f92672"></span>]
    a<span style="color:#f92672"></span> <span style="color:#f92672">=</span> map<span style="color:#f92672"></span>(sols<span style="color:#f92672"></span>) <span style="color:#66d9ef">do</span> r<span style="color:#f92672"></span> 
        norm<span style="color:#f92672"></span>(G<span style="color:#f92672"></span>(r<span style="color:#f92672"></span>, p<span style="color:#f92672"></span>))
    <span style="color:#66d9ef">end</span>
    i<span style="color:#f92672"></span> <span style="color:#f92672">=</span> findmin<span style="color:#f92672"></span>(a<span style="color:#f92672"></span>)
    sols<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>[<span style="color:#ae81ff">2</span>]]
<span style="color:#66d9ef">end</span>
recovery<span style="color:#f92672"></span> <span style="color:#f92672">=</span> find_min<span style="color:#f92672"></span>(real_solutions<span style="color:#f92672"></span>(S1<span style="color:#f92672"></span>), p1<span style="color:#f92672"></span>)
R1<span style="color:#f92672"></span>, t1<span style="color:#f92672"></span>, v1<span style="color:#f92672"></span> <span style="color:#f92672">=</span> reshape<span style="color:#f92672"></span>(recovery<span style="color:#f92672"></span>[<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>], <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>), recovery<span style="color:#f92672"></span>[<span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>], recovery<span style="color:#f92672"></span>[<span style="color:#ae81ff">13</span><span style="color:#f92672">:</span><span style="color:#ae81ff">15</span>]
</code></pre></div><p>Here is the reconstructed data:</p>
<figure>
<p style="text-align:center;"><img src="/images/rollingshutter3.png" width="600px"/></p>
<figcaption style="text-align:center;">
The reconstructed camera is in red, the velocity $v$ is in green. The plot shows the 3D points and the image points on the camera plane.
</figcaption>
</figure>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>O. Saurer, M. Pollefeys, and G. H. Lee. <em>A Minimal Solution to the Rolling Shutter Pose Estimation Problem</em>. Computer Vision and Geometry Lab, ETH Zurich, and Department of Mechanical Engineering, National University of Singapore, 2013.</p>
</li>
</ol>
</section>


</div>

<div class="">
    <p>
  Published
  
    
      by <span itemprop="author">Rami Abuzerr, Paul Breiding</span>
    
  
  <time datetime="2019-03-26T21:56:55&#43;01:00">
    26 Mar, 2019
  </time>
  
</p>

    
</div>


    
</div>
</div>
</main>
  <footer>   <footer id="footer">
    <nav>
      <ul>
        <li><span>HomotopyContinuation.jl</span></li>
        <li>
          <a href="/about/">About</a>
        </li>
        <li>
            <a href="/examples/">Examples</a>
          </li>
        <li>
          <a href="/guides/">Guides</a>
        </li>
      </ul>
    </nav>
    
  </footer> </footer>


  <script src="/js/kube.js" type="text/javascript">
  </script>
  <script src="/js/kube.legenda.js" type="text/javascript">
  </script>
  <script src="/js/master.js" type="text/javascript">
  </script>
  <script type="text/javascript">
     document.addEventListener("DOMContentLoaded", function() {
           renderMathInElement(document.body, {delimiters: [
          {left: "$$", right: "$$", display: true},
          {left: "$", right: "$", display: false},
          {left: "``", right: "``", display: false},
          
          
          
        ]});
      });</script>
</body>

</html>
