<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta name="generator" content="Hugo 0.60.0" />
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Custom Homotopies </title>

  
  <meta name="description" content="How to construct your own custom homotopy."> 
  
  
  
  
  

  

  <meta name="author" content="">


  <meta property="og:title" content="Custom Homotopies" />
<meta property="og:description" content="How to construct your own custom homotopy." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/guides/custom-homotopy/" />


  




  
  
  
  
  

  <link rel="canonical" href="/guides/custom-homotopy/">  

  

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">

  <link href="/css/font.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.min.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.legenda.css" rel="stylesheet" type="text/css">
  <link href="/css/highlight.css" rel="stylesheet" type="text/css">
  <link href="/css/master.css" rel="stylesheet" type="text/css">
  <link href="/css/kube.demo.css" rel="stylesheet" type="text/css">


  <script src="/js/jquery-2.1.4.min.js" type="text/javascript"> </script>
  <script src="/js/bootstrap.min.js" type="text/javascript"> </script>

  <script type="text/javascript" src="/js/tocbot.min.js"></script>


    
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130815722-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    console.log(document.location.hostname.search("juliahomotopycontinuation.org") )
    
    if (document.location.hostname.search("juliahomotopycontinuation.org") == -1) {
      window['ga-disable-UA-130815722-1'] = true;
    }

    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-130815722-1');
  </script>


  

    
    
    <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/atom-one-light.min.css">
    <script src="/js/highlight.pack.js"></script>
    <script src="/js/init-highlight.js"></script>
 
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>

    
    <link href="/css/custom.css" rel="stylesheet" type="text/css">
    
</head>


<body class="page-kube">
  <header>
<div class="show-sm">
    <div id="nav-toggle-box">
      <div id="nav-toggle-brand">
        <a href="/">HomotopyContinuation.jl</a>
      </div><a data-component="toggleme" data-target="#top" href="#" id="nav-toggle"><i class="kube-menu"></i></a>
    </div>
  </div>
  <div class="hide-sm" id="top">
    <div id="top-brand">
      <a href="/" title="home">HomotopyContinuation.jl</a>
    </div>
    <nav id="top-nav-main">
      <ul> 
       
       
    <li><a href="/guides/" >Guides</a></li>
    
    <li><a href="/examples/" >Examples</a></li>
    
    <li><a href="https://juliahomotopycontinuation.github.io/HomotopyContinuation.jl/stable/" >API Docs</a></li>
    
    <li><a href="/about/" >About</a></li>
    
    <li><a href="/faq/" >FAQ</a></li>
    
    <li><a href="/do-it-yourself" >Do It Yourself</a></li>
    
    <li><a href="https://www.github.com/JuliaHomotopyContinuation/HomotopyContinuation.jl" >Github</a></li>
    
      </ul>
    </nav>
    <nav id="top-nav-extra"> 
      <ul>
          
      </ul>
    </nav>
  </div>
 </header>
  <main>
<div id="main">
  <div id="hero">
    <h1>Custom Homotopies</h1>
    <p class="hero-lead">For this guide, we're going to walk through the process to construct a custom homotopy for your specific problem.</p>
  </div>
  <div id="kube-component" class="content">
    
<nav id="contents">
  <ol class="js-toc"></ol>
</nav>
<script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function() {
    tocbot.init({
      
      tocSelector: ".js-toc",
      
      contentSelector: ".content",
      
      headingSelector: "h2, h3, h4"
    });
  });
</script>




    <h3 class="section-head" id="h-introduction"><a href="#h-introduction">Introduction</a></h3>
<p>To track solutions from a start system $G$ to the target system $F$ we use by default the straight-line homotopy</p>
<p>$$
H(x,t) := (1-t)F+tG.
$$</p>
<p>But this is in general <em>not</em> the best choice since you usually leave the solution space of your problem. Therefore we support the ability to define arbitrary homotopies where you have the full power of Julia available.</p>
<p>In the following we will illustrate how to setup a custom homotopy on the following example. For polynomial systems $F$ and $G$ we want to define the homotopy</p>
<p>$$
H(x,t) = (1 - t) F( U(t) x ) +  tG( U(t) x )
$$</p>
<p>where $U(t)$ is a random path in the space of <a href="https://en.wikipedia.org/wiki/Unitary_matrix">unitary matrices</a> with $U(0) = U(1) = I$ and $I$ is the identity matrix. Such a random path can be constructed by</p>
<p>$$
U(t) =
U
\begin{bmatrix}\cos(2\pi t) &amp; -\sin(2\pi t) &amp; 0 &amp;\cdots &amp; 0 \\ \sin(2\pi t) &amp; \cos(2\pi t) &amp; 0 &amp;\cdots &amp; 0 \\ 0 &amp; 0 &amp; 1 &amp;\cdots &amp; 0\\ 0 &amp; 0 &amp; 0 &amp;\ddots &amp; 0\\ 0 &amp; 0 &amp; 0 &amp;\cdots &amp; 1
\end{bmatrix} U^T.
$$</p>
<p>with a random unitary matrix $U$.</p>
<h3 class="section-head" id="h-math"><a href="#h-math">Figuring out the math</a></h3>
<p>To define a homotopy we have to know how to compute for all $x \in \mathbb{C}^n$, $t \in \mathbb{C}$</p>
<p>$$
H(x,t), \quad \frac{\partial H}{\partial x}(x,t) \quad \text{ and } \quad \frac{\partial H}{\partial t}(x,t).
$$</p>
<p>We denote the partial derivative of $H$ w.r.t. $x$ as the <em>Jacobian</em> of $H$. For simplification (in the math as well as in the implementation) we introduce the helper homotopy</p>
<p>$$
\tilde{H}(y, t) := (1 - t) F( y ) +  tG(y).
$$</p>
<p>Note $H(x,t) = \tilde{H}(U(t)x, t)$. Using the chain rule we get for the partial derivatives</p>
<p>$$
\frac{\partial H}{\partial x}(x,t) = \frac{\partial \tilde{H}}{\partial y}(U(t)x,t) U(t)
$$</p>
<p>and</p>
<p>$$
\frac{\partial H}{\partial t}(x,t) = \frac{\partial \tilde{H}}{\partial y}(U(t)x,t) U&rsquo;(t) x + \frac{\partial \tilde{H}}{\partial t}(U(t)x,t)
$$</p>
<p>where</p>
<p>$$
U&rsquo;(t)= U
\begin{bmatrix}-2\pi\sin(2\pi t) &amp; -2\pi\cos(2\pi t) &amp; 0 &amp;\cdots &amp; 0 \\ 2\pi\cos(2\pi t) &amp; -2\pi\sin(2\pi t) &amp; 0 &amp;\cdots &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp;\cdots &amp; 0\\ 0 &amp; 0 &amp; 0 &amp;\ddots &amp; 0\\ 0 &amp; 0 &amp; 0 &amp;\cdots &amp; 0
\end{bmatrix} U^T.
$$</p>
<h3 class="section-head" id="h-data-structure"><a href="#h-data-structure">Constructing the homotopy data structures </a></h3>
<p>A custom homotopy has to satisfy a <a href="https://www.juliahomotopycontinuation.org/HomotopyContinuation.jl/latest/homotopies.html#Interface-for-custom-homotopies-1">certain interface</a>. We start with the data structure for the homotopy. A homotopy is represented by a <a href="https://docs.julialang.org/en/stable/manual/types/#Composite-Types-1"><code>struct</code></a> which is a subtype of <a href="https://www.juliahomotopycontinuation.org/HomotopyContinuation.jl/latest/homotopies.html#HomotopyContinuation.HomotopiesBase.AbstractHomotopy"><code>Homotopies.AbstractHomotopy</code></a>. Since $\tilde{H}$ is the standard straight-line homotopy we can reuse this implementation to safe us some work since homotopies compose easily.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">using</span> HomotopyContinuation<span style="color:#f92672"></span>, LinearAlgebra<span style="color:#f92672"></span>

<span style="color:#66d9ef">struct</span> RandomUnitaryPath<span style="color:#f92672"></span>{Start<span style="color:#f92672"></span>,Target<span style="color:#f92672"></span>} <span style="color:#f92672">&lt;</span><span style="color:#f92672">:</span> Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>AbstractHomotopy<span style="color:#f92672"></span>
    straightline<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span>StraightLineHomotopy<span style="color:#f92672"></span>{Start<span style="color:#f92672"></span>, Target<span style="color:#f92672"></span>}
    U<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#66d9ef">Matrix</span>{ComplexF64<span style="color:#f92672"></span>}
<span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">function</span> RandomUnitaryPath<span style="color:#f92672"></span>(start<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span>Systems<span style="color:#f92672"></span><span style="color:#f92672">.</span>AbstractSystem<span style="color:#f92672"></span>, target<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span>Systems<span style="color:#f92672"></span><span style="color:#f92672">.</span>AbstractSystem<span style="color:#f92672"></span>)
    m<span style="color:#f92672"></span>, n<span style="color:#f92672"></span> <span style="color:#f92672">=</span> size<span style="color:#f92672"></span>(start<span style="color:#f92672"></span>)
    <span style="color:#75715e"># construct a random unitary matrix</span>
    U<span style="color:#f92672"></span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">Matrix</span>(qr<span style="color:#f92672"></span>(randn<span style="color:#f92672"></span>(n<span style="color:#f92672"></span>,n<span style="color:#f92672"></span>) <span style="color:#f92672">+</span> im <span style="color:#f92672">*</span> randn<span style="color:#f92672"></span>(n<span style="color:#f92672"></span>,n<span style="color:#f92672"></span>))<span style="color:#f92672">.</span>Q<span style="color:#f92672"></span>)
    RandomUnitaryPath<span style="color:#f92672"></span>(Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>StraightLineHomotopy<span style="color:#f92672"></span>(start<span style="color:#f92672"></span>, target<span style="color:#f92672"></span>), U<span style="color:#f92672"></span>)
<span style="color:#66d9ef">end</span>
<span style="color:#75715e"># We have to define the size</span>
Base<span style="color:#f92672"></span><span style="color:#f92672">.</span>size<span style="color:#f92672"></span>(H<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span>RandomUnitaryPath<span style="color:#f92672"></span>) <span style="color:#f92672">=</span> size<span style="color:#f92672"></span>(H<span style="color:#f92672"></span><span style="color:#f92672">.</span>straightline<span style="color:#f92672"></span>)
</code></pre></div><p>To get good performance it is important to be careful about memory allocations. It is much much better to initialize a chunk of memory <em>once</em> and to reuse this memory. To support this optimization we have the concept of a <em>cache</em>. This is a <code>struct</code> with supertype <a href="https://www.juliahomotopycontinuation.org/HomotopyContinuation.jl/latest/homotopies.html#HomotopyContinuation.HomotopiesBase.AbstractHomotopyCache"><code>Homotopies.AbstractHomotopyCache</code></a> where we allocate all memory necessary to evaluate and differentiate our homotopy. This is an optimization and not necessary to have at the beginning, but for the best it is necessary to implement it. To illustrate how to do this, we will implement here a cache. Don't look with too much detail on the exact type definition for now, we just allocate a bunch of stuff which will make much more sense later. As a constructor for the cache we have to define the <a href="https://www.juliahomotopycontinuation.org/HomotopyContinuation.jl/latest/homotopies.html#HomotopyContinuation.HomotopiesBase.cache"><code>Homotopies.cache</code></a> method.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">struct</span> RandomUnitaryPathCache<span style="color:#f92672"></span>{C<span style="color:#f92672"></span>, T1<span style="color:#f92672"></span>, T2<span style="color:#f92672"></span>} <span style="color:#f92672">&lt;</span><span style="color:#f92672">:</span> Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>AbstractHomotopyCache<span style="color:#f92672"></span>
    straightline<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span>C<span style="color:#f92672"></span>
    U_t<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#66d9ef">Matrix</span>{ComplexF64<span style="color:#f92672"></span>}
    y<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#66d9ef">Vector</span>{T1<span style="color:#f92672"></span>}
    <span style="color:#75715e"># More temporary storage necessary to avoid allocations</span>
    jac<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#66d9ef">Matrix</span>{T2<span style="color:#f92672"></span>} <span style="color:#75715e"># holds a jacobian</span>
    dt<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#66d9ef">Vector</span>{T2<span style="color:#f92672"></span>} <span style="color:#75715e"># holds a derivative w.r.t. t</span>
    U<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#66d9ef">Matrix</span>{ComplexF64<span style="color:#f92672"></span>} <span style="color:#75715e"># holds something like U</span>
<span style="color:#66d9ef">end</span>

<span style="color:#75715e"># A cache is always constructed by this method.</span>
<span style="color:#66d9ef">function</span> Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>cache<span style="color:#f92672"></span>(H<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span>RandomUnitaryPath<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>)
    U_t<span style="color:#f92672"></span> <span style="color:#f92672">=</span> copy<span style="color:#f92672"></span>(H<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span>)
    y<span style="color:#f92672"></span> <span style="color:#f92672">=</span> U_t<span style="color:#f92672"></span> <span style="color:#f92672">*</span> x<span style="color:#f92672"></span>
    straightline<span style="color:#f92672"></span> <span style="color:#f92672">=</span> Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>cache<span style="color:#f92672"></span>(H<span style="color:#f92672"></span><span style="color:#f92672">.</span>straightline<span style="color:#f92672"></span>, y<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>)

    jac<span style="color:#f92672"></span> <span style="color:#f92672">=</span> Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>jacobian<span style="color:#f92672"></span>(H<span style="color:#f92672"></span><span style="color:#f92672">.</span>straightline<span style="color:#f92672"></span>, y<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>, straightline<span style="color:#f92672"></span>)
    dt<span style="color:#f92672"></span> <span style="color:#f92672">=</span> jac<span style="color:#f92672"></span> <span style="color:#f92672">*</span> y<span style="color:#f92672"></span>
    U<span style="color:#f92672"></span> <span style="color:#f92672">=</span> copy<span style="color:#f92672"></span>(U_t<span style="color:#f92672"></span>)
    RandomUnitaryPathCache<span style="color:#f92672"></span>(straightline<span style="color:#f92672"></span>, U_t<span style="color:#f92672"></span>, y<span style="color:#f92672"></span>, jac<span style="color:#f92672"></span>, dt<span style="color:#f92672"></span>, U<span style="color:#f92672"></span>)
<span style="color:#66d9ef">end</span>
</code></pre></div><h3 class="section-head" id="h-implementation"><a href="#h-implementation">Implementing the evaluation and derivatives</a></h3>
<p>We start with implementing subroutines to evaluate and differentiate $U(t)$ as well as computing $U(t)x$ and $U&rsquo;(t)x$. We use the <code>U_t</code> and <code>y</code> fields in <code>cache</code> to store the values $U(t)$ and $U(t)x$ (resp. $U&rsquo;(t)$ and $U&rsquo;(t)x$)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#75715e"># U(t)x</span>
<span style="color:#66d9ef">function</span> Ut_mul_x!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span>, U<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>)
    <span style="color:#75715e"># We start with U * (the 2x2 sin-cos block + I)</span>
    cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span> <span style="color:#f92672">.=</span> U<span style="color:#f92672"></span>
    s<span style="color:#f92672"></span>, c<span style="color:#f92672"></span> <span style="color:#f92672">=</span> sin<span style="color:#f92672"></span>(<span style="color:#ae81ff">2</span>π<span style="color:#f92672">*</span>t<span style="color:#f92672"></span>), cos<span style="color:#f92672"></span>(<span style="color:#ae81ff">2</span>π<span style="color:#f92672">*</span>t<span style="color:#f92672"></span>)
    <span style="color:#66d9ef">for</span> i<span style="color:#f92672"></span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>size<span style="color:#f92672"></span>(U<span style="color:#f92672"></span>, <span style="color:#ae81ff">1</span>)
        cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> U<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>,<span style="color:#ae81ff">2</span>] <span style="color:#f92672">*</span> s<span style="color:#f92672"></span> <span style="color:#f92672">+</span> U<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>,<span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> c<span style="color:#f92672"></span>
        cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>, <span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> U<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>,<span style="color:#ae81ff">2</span>] <span style="color:#f92672">*</span> c<span style="color:#f92672"></span> <span style="color:#f92672">-</span> U<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>,<span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> s<span style="color:#f92672"></span>
    <span style="color:#66d9ef">end</span>
    <span style="color:#75715e"># U(t) = cache.U * U&#39;</span>
    <span style="color:#75715e"># y = cache.y = U(t) * x</span>
    mul!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>y<span style="color:#f92672"></span>, mul!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>U_t<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span>, U<span style="color:#f92672">&#39;</span>), x<span style="color:#f92672"></span>)
<span style="color:#66d9ef">end</span>

<span style="color:#75715e"># U&#39;(t)x</span>
<span style="color:#66d9ef">function</span> U_dot_t_mul_x!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span>, U<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>)
    <span style="color:#75715e"># We start with U * (the derivative of the 2x2 sin-cos block + 0)</span>
    cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span> <span style="color:#f92672">.=</span> zero<span style="color:#f92672"></span>(eltype<span style="color:#f92672"></span>(U<span style="color:#f92672"></span>))
    s<span style="color:#f92672"></span>, c<span style="color:#f92672"></span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>π<span style="color:#f92672">*</span>sin<span style="color:#f92672"></span>(<span style="color:#ae81ff">2</span>π<span style="color:#f92672">*</span>t<span style="color:#f92672"></span>), <span style="color:#ae81ff">2</span>π<span style="color:#f92672">*</span>cos<span style="color:#f92672"></span>(<span style="color:#ae81ff">2</span>π<span style="color:#f92672">*</span>t<span style="color:#f92672"></span>)
    <span style="color:#66d9ef">for</span> i<span style="color:#f92672"></span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>size<span style="color:#f92672"></span>(U<span style="color:#f92672"></span>, <span style="color:#ae81ff">1</span>)
        cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span>  U<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>,<span style="color:#ae81ff">2</span>] <span style="color:#f92672">*</span> c<span style="color:#f92672"></span> <span style="color:#f92672">-</span> U<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>,<span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> s<span style="color:#f92672"></span>
        cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>, <span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>U<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>,<span style="color:#ae81ff">2</span>] <span style="color:#f92672">*</span> s<span style="color:#f92672"></span> <span style="color:#f92672">-</span> U<span style="color:#f92672"></span>[i<span style="color:#f92672"></span>,<span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> c<span style="color:#f92672"></span>
    <span style="color:#66d9ef">end</span>

    <span style="color:#75715e"># U&#39;(t) = cache.U * U&#39;</span>
    <span style="color:#75715e"># y&#39; = cache.y = U&#39;(t) * x</span>
    mul!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>y<span style="color:#f92672"></span>, mul!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>U_t<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span>, U<span style="color:#f92672">&#39;</span>), x<span style="color:#f92672"></span>)
<span style="color:#66d9ef">end</span>
</code></pre></div><p>Now we are ready to implement $H(x,t)$, its Jacobian and the derivative w.r.t. $t$.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">function</span> Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>evaluate!<span style="color:#f92672"></span>(out<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span>RandomUnitaryPath<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span>)
    y<span style="color:#f92672"></span> <span style="color:#f92672">=</span> Ut_mul_x!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>)
    Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>evaluate!<span style="color:#f92672"></span>(out<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">.</span>straightline<span style="color:#f92672"></span>, y<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>straightline<span style="color:#f92672"></span>)
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">function</span> Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>jacobian!<span style="color:#f92672"></span>(out<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span>RandomUnitaryPath<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span>)
    y<span style="color:#f92672"></span> <span style="color:#f92672">=</span> Ut_mul_x!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>)
    Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>jacobian!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>jac<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">.</span>straightline<span style="color:#f92672"></span>, y<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>straightline<span style="color:#f92672"></span>)
    mul!<span style="color:#f92672"></span>(out<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>jac<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>U_t<span style="color:#f92672"></span>) <span style="color:#75715e"># out = J_H(y, t) * U(t)</span>
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">function</span> Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>dt!<span style="color:#f92672"></span>(out<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span>RandomUnitaryPath<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span>)
    y<span style="color:#f92672"></span> <span style="color:#f92672">=</span> Ut_mul_x!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>)
    <span style="color:#75715e"># chain rule</span>
    Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>jacobian_and_dt!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>jac<span style="color:#f92672"></span>, out<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">.</span>straightline<span style="color:#f92672"></span>, y<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>straightline<span style="color:#f92672"></span>)
    y_dot<span style="color:#f92672"></span> <span style="color:#f92672">=</span> U_dot_t_mul_x!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>) <span style="color:#75715e"># y_dot = U&#39;(t)x</span>
    mul!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>dt<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>jac<span style="color:#f92672"></span>, y_dot<span style="color:#f92672"></span>) <span style="color:#75715e"># dt = J_H(y, t) * y_dot</span>
    out<span style="color:#f92672"></span> <span style="color:#f92672">.+=</span> cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>dt<span style="color:#f92672"></span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p>We also support to compute <code>evaluate!</code> and <code>jacobian!</code>  simultaneously as well as to compute <code>jacobian!</code> and <code>dt!</code> simultaneously. This can be very beneficial for the performance, so let's implement this here since this mostly involve copy-paste.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">function</span> Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>evaluate_and_jacobian!<span style="color:#f92672"></span>(val<span style="color:#f92672"></span>, jac<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span>RandomUnitaryPath<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span>)
    y<span style="color:#f92672"></span> <span style="color:#f92672">=</span> Ut_mul_x!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>)
    Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>evaluate_and_jacobian!<span style="color:#f92672"></span>(val<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>jac<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">.</span>straightline<span style="color:#f92672"></span>, y<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>straightline<span style="color:#f92672"></span>)
    mul!<span style="color:#f92672"></span>(jac<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>jac<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>U_t<span style="color:#f92672"></span>)
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">function</span> Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>jacobian_and_dt!<span style="color:#f92672"></span>(jac<span style="color:#f92672"></span>, dt<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">:</span><span style="color:#f92672">:</span>RandomUnitaryPath<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span>)
    y<span style="color:#f92672"></span> <span style="color:#f92672">=</span> Ut_mul_x!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>)
    Homotopies<span style="color:#f92672"></span><span style="color:#f92672">.</span>jacobian_and_dt!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>jac<span style="color:#f92672"></span>, dt<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">.</span>straightline<span style="color:#f92672"></span>, y<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>straightline<span style="color:#f92672"></span>)
    mul!<span style="color:#f92672"></span>(jac<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>jac<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>U_t<span style="color:#f92672"></span>) <span style="color:#75715e"># jac = J_H(y, t) * U(t)</span>
    y_dot<span style="color:#f92672"></span> <span style="color:#f92672">=</span> U_dot_t_mul_x!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span>, H<span style="color:#f92672"></span><span style="color:#f92672">.</span>U<span style="color:#f92672"></span>, x<span style="color:#f92672"></span>, t<span style="color:#f92672"></span>) <span style="color:#75715e"># y_dot = U&#39;(t)x</span>
    mul!<span style="color:#f92672"></span>(cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>dt<span style="color:#f92672"></span>, cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>jac<span style="color:#f92672"></span>, y_dot<span style="color:#f92672"></span>) <span style="color:#75715e"># dt = J_H(y, t) * y_dot</span>
    dt<span style="color:#f92672"></span> <span style="color:#f92672">.+=</span> cache<span style="color:#f92672"></span><span style="color:#f92672">.</span>dt<span style="color:#f92672"></span>
<span style="color:#66d9ef">end</span>
</code></pre></div><h3 class="section-head" id="h-testing"><a href="#h-testing">Testing our implementation</a></h3>
<p>Implementing these methods without ever testing them is &hellip; not a good idea. Also just throwing the homotopy into <code>solve</code> can result in confusing error messages. Therefore we provide a set of tests against which we can test our implementation. Although they do not check that we implemented the math correctly (or that our math is correct in the first place), they will catch any runtime errors.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#75715e"># Let us construct some test systems</span>
<span style="color:#a6e22e">@polyvar</span><span style="color:#f92672"></span> x<span style="color:#f92672"></span> y<span style="color:#f92672"></span> z<span style="color:#f92672"></span>;

F<span style="color:#f92672"></span> <span style="color:#f92672">=</span> SPSystem<span style="color:#f92672"></span>([x<span style="color:#f92672"></span><span style="color:#f92672">^</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>y<span style="color:#f92672"></span><span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>x<span style="color:#f92672"></span><span style="color:#f92672">*</span>z<span style="color:#f92672"></span>, z<span style="color:#f92672"></span><span style="color:#f92672">^</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>x<span style="color:#f92672"></span><span style="color:#f92672">+</span><span style="color:#ae81ff">3</span>y<span style="color:#f92672"></span><span style="color:#f92672">^</span><span style="color:#ae81ff">2</span>]);
G<span style="color:#f92672"></span> <span style="color:#f92672">=</span> SPSystem<span style="color:#f92672"></span>([z<span style="color:#f92672"></span><span style="color:#f92672">*</span>x<span style="color:#f92672"></span><span style="color:#f92672">^</span><span style="color:#ae81ff">2</span><span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>x<span style="color:#f92672"></span><span style="color:#f92672">*</span>y<span style="color:#f92672"></span><span style="color:#f92672">^</span><span style="color:#ae81ff">2</span>, z<span style="color:#f92672"></span><span style="color:#f92672">^</span><span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>x<span style="color:#f92672"></span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>x<span style="color:#f92672"></span><span style="color:#f92672">*</span>y<span style="color:#f92672"></span><span style="color:#f92672">*</span>z<span style="color:#f92672"></span><span style="color:#f92672">^</span><span style="color:#ae81ff">2</span>]);

<span style="color:#75715e"># Here we can test that our implementation does not produce an error</span>
InterfaceTest<span style="color:#f92672"></span><span style="color:#f92672">.</span>homotopy<span style="color:#f92672"></span>(RandomUnitaryPath<span style="color:#f92672"></span>(G<span style="color:#f92672"></span>, F<span style="color:#f92672"></span>))
</code></pre></div><pre><code>Test Passed
</code></pre><h3 class="section-head" id="h-using"><a href="#h-using">Using our new homotopy</a></h3> We are now ready to use our new homotopy!
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">solve<span style="color:#f92672"></span>([x<span style="color:#f92672"></span><span style="color:#f92672">^</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> y<span style="color:#f92672"></span>, y<span style="color:#f92672"></span><span style="color:#f92672">^</span><span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>x<span style="color:#f92672"></span><span style="color:#f92672">-</span>x<span style="color:#f92672"></span>], homotopy<span style="color:#f92672"></span><span style="color:#f92672">=</span>RandomUnitaryPath<span style="color:#f92672"></span>)
</code></pre></div><pre><code>AffineResult with 8 tracked paths
==================================
• 6 non-singular solutions (2 real)
• 1 singular solution (1 real)
• 1 solution at infinity
• 0 failed paths
• random seed: 847463
</code></pre><p>Alternatively we could also construct the homotopy directly and give it to <code>solve</code> together with start solutions. Note that in this case we have to ensure that our homotopy is already homogeneous.</p>

    
    
  </div>
</div>
</main>
  <footer></footer>


  <script src="/js/kube.js" type="text/javascript">
  </script>
  <script src="/js/kube.legenda.js" type="text/javascript">
  </script>
  <script src="/js/master.js" type="text/javascript">
  </script>
  <script type="text/javascript">
     document.addEventListener("DOMContentLoaded", function() {
           renderMathInElement(document.body, {delimiters: [
          {left: "$$", right: "$$", display: true},
          {left: "$", right: "$", display: false},
          {left: "``", right: "``", display: false},
          
          
          
        ]});
      });</script>
</body>

</html>
